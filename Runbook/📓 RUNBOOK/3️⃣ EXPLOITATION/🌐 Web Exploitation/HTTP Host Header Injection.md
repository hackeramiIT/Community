#Exploit_noti 


- [[#Password Reset Poisoning]]
- [[#SSRF]]
# Descrizione
L'`Host header` è una riga che il tuo browser aggiunge ad ogni richiesta che fa a un sito web.  
Serve per dire al server a quale sito vuoi collegarti.
Gli **attacchi HTTP Host Header** sfruttano i siti che **gestiscono in modo non sicuro** il valore dell’Host header.  
Se il server **si fida** ciecamente di questo valore, un 
attaccante può **manipolarlo** per attacchi di :
- [Password reset poisoning](#Password reset poisoning)
- [SSRF](#SSRF)

---
# Password Reset Poisoning

Il **Password reset poisoning** è una tecnica con cui un attaccante induce un sito web vulnerabile a generare un link per il reset della password che punta a un dominio sotto il controllo dell'attaccante.  
Questo comportamento può essere sfruttato per **rubare i token segreti** necessari a reimpostare la password di utenti arbitrari e, infine, **compromettere i loro account**.

Le vulnerabilità di questo attacco derivano dal fatto che il server si fida delgi header inviati dalla parte client.  Le vulnerabilità sono le seguenti

- **`Host`** header *([writeup](https://portswigger.net/web-security/host-header/exploiting/password-reset-poisoning/lab-host-header-basic-password-reset-poisoning))*
	1. Richiedere il reset password per l'utente che si vuole attaccare (es: *admin*)
	2. Cambiare `Host` col tuo server malevolo.
    3. Far sì che il sito mandi un'email alla vittima **con un link di reset password** puntato sul tuo server.
- **`X-Forwarded-Host`** header ([writeup](https://portswigger.net/web-security/authentication/other-mechanisms/lab-password-reset-poisoning-via-middleware)):
	1. Richiedere il reset password per l'utente che si vuole attaccare (es: *admin*)
	2. Modifichi `X-Forwarded-Host` nella richiesta di reset password → metti il tuo server malevolo.
	3. Il sito costruisce il **link di reset password** usando il tuo server invece di quello vero.
    4. Quando la vittima clicca il link nella mail → **ti invia il token** di reset.
- **Dangling Markup Language* ([writeup](https://portswigger.net/web-security/host-header/exploiting/password-reset-poisoning/lab-host-header-password-reset-poisoning-via-dangling-markup)):** il valore di `Host`, contenuto nell'HTML della mail, non viene sanitizzato correttamente e permette di interrompere il codice HTML e iniettare link esterni.
	1. Quando il server genera l'email, inserisce il valore di `Host` dentro un pezzo di HTML. Se non filtra bene il valore
	2. Puoi **rompere** l'HTML e **iniettare un tuo link** (dangling markup).
	3. Il browser (o l'antivirus) poi **richiama** automaticamente il tuo server, **portandosi dietro tutto il testo** dell'email, inclusa la nuova password.

---
# [[Web Exploitations/SSRF]]

- **Authentication Bypass ([writeup](https://portswigger.net/web-security/host-header/exploiting/lab-host-header-authentication-bypass)):** cambiando l'`Host` header in 'localhost' il server penserà che la richiesta venga da sé stesso, quindi si fiderà e farà accedere a risorse interne (es: */admin*) e quindi [[Disclosure Information]].
- **Routing-based ([writeup](https://portswigger.net/web-security/host-header/exploiting/lab-host-header-routing-based-ssrf)):**  
	1. Cerchiamo con *Burp Intruder* una macchina nella rete interna al server (es: 192.168.1.0/255).
	2. Cambiamo l'`Host` header con l'indirizzo trovato, il server penserà che la richiesta provenga dalla rete interna e pertanto farà accedere a risorse interne (es: /admin).
- **Absolute URL ([writeup](https://portswigger.net/web-security/host-header/exploiting/lab-host-header-ssrf-via-flawed-request-parsing)):** quando l'URL è relativo (es: GET /) allora il server deve affidarsi all'`Host` header per capire la destinazione perciò effettua maggiori controlli su quest'ultimo. Se l'URL è assoluto (es: GET https://esempio.com/) allora il server effettuerà meno controlli sull'`Host`header e quindi sarà più manipolabile.
- ([writeup](https://portswigger.net/web-security/host-header/exploiting/lab-host-header-host-validation-bypass-via-connection-state-attack))

---

---

