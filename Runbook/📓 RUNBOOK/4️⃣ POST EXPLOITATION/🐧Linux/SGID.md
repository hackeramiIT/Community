#Privesc_Linux

---
---
---
#### INDICE

- [[#Introduzione]]
- [[#Enumerazione]]
- [[#File SGID Editabili]]
- [[#Accesso a Gruppi Sensibili]]
- [[#SGID su Directory]]
- [[#GTFOBins]]

---
---
---
### Introduzione
Il bit **SGID (Set Group ID)**, se applicato a un file eseguibile, fa sì che quel file venga eseguito con i **privilegi del gruppo proprietario**, indipendentemente da chi lo esegue.

Pur essendo meno efficace del bit SUID (che eleva ai privilegi utente, spesso root), **SGID** può comunque rappresentare una vulnerabilità significativa se:
- il gruppo associato ha accesso a file critici (es: `shadow`, `adm`, `disk`, ecc.)
- l’utente ha il permesso di **modificare** il file
- il gruppo può accedere a script o cron job sensibili

---
### Enumerazione
Per trovare i file con bit SGID attivo:

```
find / -perm -2000 -type f 2>/dev/null`
```

Per isolare file appartenenti a **gruppi privilegiati**:

```
find / -perm -2000 -ls 2>/dev/null | grep -E 'shadow|sudo|adm|disk'
```

---
### File SGID Editabili
Un **file eseguibile SGID modificabile** può essere sostituito con un payload malevolo. Il file continuerà a essere eseguito con i privilegi del gruppo assegnato.

Esempio: se un utente ha accesso in scrittura a un file con permessi:

```
-rwxr-sr-x 1 root shadow 12345 ./vuln
```

Può fare:

```
echo "/bin/bash" > ./vuln
chmod +x ./vuln
./vuln  # Shell con gruppo shadow
```

---
### Accesso a Gruppi Sensibili
Alcuni gruppi UNIX, anche se non equivalenti a `root`, possono avere privilegi critici:
- `shadow`: lettura di `/etc/shadow`
- `adm`, `syslog`: lettura log sensibili in `/var/log/`
- `disk`: accesso a dispositivi `/dev/sd*`
- `backup`: accesso a file di sistema archiviati
- `sudo`: potenzialmente bypass controlli

Se un binario SGID appartiene a uno di questi gruppi, va **analizzato attentamente**.

---
### SGID su Directory
Quando una directory ha il bit SGID:

```
drwxrwsr-x 2 root group /opt/backupdir
```

ogni file o directory creato al suo interno **eredita il gruppo** della directory. Se il gruppo ha privilegi (es. uno script in cron o backup), un attaccante potrebbe inserirvi file malevoli.

Esempio:

```
echo "/bin/bash" > /opt/backupdir/f.sh
chmod +x /opt/backupdir/shell.sh
sh shell.sh
```

Se un cron job con `group=backups` esegue script da lì, l’attaccante ottiene esecuzione con privilegi di gruppo.

---
### GTFOBins
Come per SUID, anche per SGID vale la regola: se trovi un **binario noto con bit SGID**, controlla se è presente su [GTFOBins](https://gtfobins.github.io).

Usa il filtro `SGID` nella ricerca per vedere gli exploit noti per quel binario.