#Privesc_Linux

---
---
---
#### INDICE

- [[#Introduzione]]
- [[#Enumerazione]]
- [[#File SUID Editabili]]
- [[#Buffer Overflow]]
- [[#Percorso relativo]]
- [[#GTFOBins]]

---
---
---
### Introduzione
Il bit *SUID (Set User ID)*, quando impostato su un file eseguibile, fa sÃ¬ che il file venga eseguito con i privilegi del proprietario del file (di solito `root`), anche se invocato da un utente normale. Durante un penetration test, la scoperta di eseguibili con SUID Ã¨ fondamentale, poichÃ© possono consentire l'esecuzione di comandi con privilegi elevati, specialmente se:

- sono binari noti (es. `find`, `vim`, `perl`, ecc.)
- sono script personalizzati o non ben sanitizzati

---
### Enumerazione
Per trovare i file con bit SUID attivo:

```
find / -perm -4000 2>/dev/null
```

Oppure, per filtrarli in base allâ€™utente root:

```
find / -user root -perm -4000 -exec -ls 2>/dev/null
```

---
### File SUID Editabili
Una delle vulnerabilitÃ  piÃ¹ critiche nei sistemi Unix-like Ã¨ la presenza di **file con bit SUID impostato e permessi di scrittura per utenti non privilegiati**. Se un utente normale puÃ² **modificare il contenuto** di un file eseguibile con SUID (tipicamente posseduto da `root`), puÃ² sostituirlo con un **payload malevolo** (es:[[ðŸ”¡ Glossario#Reverse shell| reverse shell]]) ed eseguirlo con privilegi elevati.

Ad esempio se lâ€™utente puÃ² modificare `-rwsr-xr-x backup.sh`:

```
echo "/bin/bash" > ./backup.sh
chmod +x ./backup.sh
./backup.sh  #Shell root
```

> Se una directory Ã¨ scrivibile, lâ€™attaccante puÃ² cancellarlo e ricrearlo con lo stesso nome.

ðŸ“šâ€‹ Writeups:
- [[Linux#Irked| Irked]],

---
### Buffer Overflow
Questi attacchi si verificano quando il programma effettua operazioni di scrittura in memoria **senza controllare correttamente i limiti di buffer**, ad esempio utilizzando funzioni insicure come `gets()`, `strcpy()`, `sprintf()` o `scanf()` senza formato.

PoichÃ© il bit SUID mantiene i privilegi anche se lâ€™attaccante lancia lâ€™exploit, la shell ottenuta ha permessi `root`.

ðŸ“šâ€‹ Writeups:
- [[Linux#Frolic| Frolic]],

---
### Percorso relativo
#### Directory corrente
Una pericolosa vulnerabilitÃ  si verifica quando un **binario con bit SUID attivo** (cioÃ¨ eseguito sempre con i privilegi del proprietario, spesso `root`) richiama un altro script o binario usando un path relativo (es: `./script.sh` o `system("backup")` per python) invece del percorso assoluto.

In questi casi, se lâ€™utente puÃ² controllare la directory da cui viene eseguito il programma, puÃ² **creare o sostituire** il file referenziato e farlo eseguire con **privilegi root**.

Ad esempio uno script col seguente contenuto:

```
int main() {     
system("backup.sh");     #Riga vulnerabile
return 0;
}
```

Ora, se esegui il binario in una directory dove esiste un file `backup.sh` controllato da te:

```
echo '/bin/bash' > backup.sh
chmod +x backup.sh
./vuln
```
#### Variabile PATH
Un errore frequente dei file permessi SUID, Ã¨ quello di affidarsi alla variabile di ambiente[[ðŸ”¡ Glossario#Variabili Globali| PATHÂ°]]. Se un eseguibile con SUID richiama un comando generico come `cp`, `ls`, `cat`, senza `/usr/bin/cp` o simili, lâ€™attaccante puÃ² **manipolare `PATH` per eseguire un comando arbitrario con privilegi root**.

Supponiamo di avere lo script `vuln.sh` che esegua il binario `/usr/bin/backup.sh` con SUID richiamato all'interno del file senza path assoluto quindi `backup.sh`:

```
export PATH=/tmp:$PATH #Inseriamo una directory sotto il nostro controllo come /tmp
echo "/bin/bash" > ./backup.sh #Creiamo il binario malevolo
chmod +x backup.sh
sh vuln.sh
```

ðŸ“šâ€‹ Writeups:
- [[Linux#Magic| Magic]],[[Linux#Kenobi| Kenobi]],[[Linux#Pandora| Pandora]]

---
### GTFOBins
La piattaforma [GTFOBins](https://gtfobins.github.io) cataloga metodi per ottenere shell tramite binari SUID noti. Se trovi un binario con SUID, verifica se Ã¨ presente sulla piattaforma.

ðŸ“šâ€‹ Writeups:
- [[Linux#MrRobot| MrRobot]],[[Linux#Nukem| Nukem]],[[Linux#Nibbles| Nibbles]],[[Linux#Astronaut| Astronaut]],[[Linux#BBScute| BBScute]],[[Linux#Mzavee| Mzavee]],[[Linux#Rootme| Rootme]],[[Linux#Jarvis| Jarvis]],[[Linux#Quackerjack| Quackerjack]],[[Linux#Mango| Mango]],[[Linux#XposedAPI| XposedAPI]],[[Linux#Sorcerer| Sorcerer]],[[Linux#Boiler CTF| BoilerCTF]],